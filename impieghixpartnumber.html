<html>
<head>
<title>Produzione giornaliera</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<link rel="stylesheet" href="css/style-3.css" type="text/css">
<link rel="stylesheet" href="css/style-container-3.css" type="text/css">
<!--
<link href="http://fonts.googleapis.com/css?family=Bitter&subset=latin" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/nestedsidemenu.css" />
-->
</head>
<body>
	<div class="grid-container">
			<div class="colonna0" >
				<img class="menu-icon" src="img/back_01.png" onclick="var x = document.getElementById('colonna1');if (x.style.display === 'none') {   x.style.display = 'block'; $('.menu-icon').attr('src','img/back_01.png');} else {x.style.display = 'none'; $('.menu-icon').attr('src','img/forward_01.png');}"/>
			<!--</div>-->
			<div class="colonna1" id="colonna1">
<div class="header">
	<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<!--<div class="funzioni">-->
	<div id="sidebar">
			<div class="menu nestedsidemenu">
				<!--<div class="closeButton"></div>				
				<div class="nestedsidemenu">
					<br style="clear: left" />
				</div>-->
			</div>
	</div>
		<!--<div class="menuButton"></div>-->	
	</div>
	</div>
	<div class="colonna2" id="main">
        <div id="content">
	<div class="corpoLista" id="corpoLista" style="display:block">
		<div class="corpoListaHeader">Produzione oraria e giornaliera</div>
		<form id="myForm" action="impieghixpartnumber.php" method="POST">
				<div class="nav">
						<input onclick="pagination('first')" id="exit" type="button" value="<<" />
						<input onclick="pagination('prev')" id="exit" type="button" value="<" />
						<span id="pagsup" type="text" name="pagsup" readonly="readonly" ></span>
						<input onclick="pagination('next')" id="exit" type="button" value=">" />
						<input onclick="pagination('last')" id="exit" type="button" value=">>" />
					</div>
					<div class="comandi">
							<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
							<div class=allinea>
								<button onclick="aggiornaLista()">Aggiorna</button>
							</div>
							<div class=allinea>
								<button onclick="invocaFiltro()">Ricerca</button>
							</div>
							<div class=allinea>
								<button onclick="invocaExportMovMag()">Export Produzione giornaliera</button>
							</div>
							<div class=allinea>
							<a id="cmdReport" href="impieghixpartnumber.php?op=report&pag=1&npag=1&nrighe=1000&tipoAggregazione=G&tipoRappresentazione=I&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
							</div>
						</div>
						<div style="clear:both;"></div>
			<label class="tipoReport">Tipo Aggregazione:</label>
			<select class="tipoReport" type="text" name="tipoAggregazione" id="tipoAggregazione" onChange="aggiornaParametriSelect('tipoAggregazione')">
			<option value="H">Oraria</option>
			<option value="G" selected >Giornaliera</option>
			<option value="M">Mensile</option>
			<option value="A">Annuale</option>
			</select>
			<!--
			<label class="tipoReport">Tipo Rappresentazione:</label>
			<select class="tipoReport" type="text" name="tipoRappresentazione" id="tipoRappresentazione" onChange="aggiornaParametriSelect('tipoRappresentazione')">
			<option value="I" selected >Integrale</option>
			<option value="P">Percentuale</option>
			</select>-->
			</p>
			<div class="lista">
				<table  id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
				<thead>
				<tr>	

				<!--<th>ID macchina</th><th>Descrizione</th>-->
				<th class="sorting" id="th_posizione" onclick="setOrdinamento('posizione')">Macchina</th>
				<th class="sorting" id="th_datehour" onclick="setOrdinamento('datehour')">Data</th>
				<th class="sorting" id="th_product" onclick="setOrdinamento('product')">Part Number</th>
				<th class="sorting" id="th_articolo" onclick="setOrdinamento('articolo')">Articolo</th>
				<th class="sorting" id="th_op" onclick="setOrdinamento('op')">OP</th>
				<th class="sorting" id="th_qta" onclick="setOrdinamento('qta')">Qta Ordine</th>
				<th class="sorting" id="th_totalpieces" onclick="setOrdinamento('totalpieces')">Qt√† prodotta</th>
				<!--<th>planned production Time</th><th>operating Time</th><th>ideal operating Time</th><th>total Time</th><th>active</th><th>%</th><th>idle</th><th>%</th><th>alert</th><th>%</th><th>production</th><th>setup</th><th>teardown</th><th>maintenance</th><th>process development</th>-->
				</tr>
				</thead>
					<tbody>
					<!-- IL BODY E' INIZIALMENTE VUOTO -->
					</tbody>
				</table>
			</div>
			<br/>
			<div class="nav">
				<input onclick="pagination('first')" id="exit" type="button" value="<<" />
				<input onclick="pagination('prev')" id="exit" type="button" value="<" />
				<span id="paginf" type="text" name="paginf" readonly="readonly" ></span>
				<input id="pag" type="hidden" name="pag" readonly="readonly" value="1" />
				<input onclick="pagination('next')" id="exit" type="button" value=">" />
				<input onclick="pagination('last')" id="exit" type="button" value=">>" />
				<input id="op" type="hidden" name="op" value="list" />
				<input id="npag" type="hidden" name="npag" value="0" />
				<input id="nrighe" type="hidden" name="nrighe" value="10" />
				<input id="ordinamento" type="hidden" name="ordinamento" value="" />
			</div>
			<div class="comandi">
				<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
				<div class=allinea>
					<button onclick="aggiornaLista()">Aggiorna</button>
				</div>
				<div class=allinea>
                	<button onclick="invocaFiltro()">Ricerca</button>
				</div>
				<div class=allinea>
					<button onclick="invocaExportMovMag()">Export Produzione giornaliera</button>
				</div>
				<div class=allinea>
				<a id="cmdReport" href="impieghixpartnumber.php?op=report&pag=1&npag=1&nrighe=1000&tipoAggregazione=G&tipoRappresentazione=I&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
				</div>
			</div>
			<div class="filtro">
				<label id="opFiltroLabel">Filtro:</label>
				<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
            </div>
		</form>  
		<div class="esito">
		<span id="resultmyForm"></span>
		</div>
	</div> 
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">Criteri di selezione Produzione</div> 
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
					<td>Posizione Macchina</td>
						<td><select class="operatore" type="text" name="posizione_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="posizione" /></td>
					</tr>
					<tr>
					<td>Prodotto</td>
					<td><select class="operatore" type="text" name="part_number_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="part_number" /></td>
					</tr>
					<!--
					<tr>
					<td>Posizione</td><td><input type="text" name="posizione" /></td>
					</tr>
					-->
					<tr>
					<td>Data inizio periodo</td>
						<td><select class="operatore" type="text" name="start_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="start_date" /></td>
					</tr>
					<tr>
					<td>Data fine periodo</td>
						<td><select class="operatore" type="text" name="end_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="end_date" /></td>
					</tr>

				</table>
			</div>
			<div class="comandi">
					<button onclick="aggiornaLista(aggiornaPrmFiltroExport(applicaFiltro()))">Applica</button>
					<button onclick="chiudiFiltro()">Esci</button>
					<button onClick="this.form.reset();impostaFiltro();" >Ripristina</button>
				</div>
		</form>  
	</div> 
	<div class="corpoNascosto"style="display:none">
		<form id="myFormHidden" action="impieghixpartnumber.php" method="POST">
			<input id="tipoAggregazione3" type="text" name="tipoAggregazione" value="" />
			<input id="tipoRappresentazione3" type="text" name="tipoRappresentazione" value="" />
			<input id="valFiltro3" type="text" name="filtro" readonly="readonly" value="" />
			<input type="hidden" name="nrighe" value="1000" />
			<input type="hidden" name="npag" value="1" />
			<input type="hidden" name="pag" value="1" />
			<input id="op3" type="hidden" name="op" value="exportMovMag" />
		</form>
	</div>

<!-- -->
	</div> 
	</div> 
</div> 

<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script type="text/javascript" src="script/myScript.js"></script>
<script type="text/javascript" src="script/numberFormat154.js"></script>
<script type="text/javascript">
	
	$(document).ready(function() {
		$('.menuButton').click(function()
		{
			$('#sidebar').animate({"left":"0px"}, 10);
		});
	
		$('.closeButton').click(function()
		{
			$('#sidebar').animate({"left":"-236px"}, 10);
	});
/*
		$date = "2011-06-14";
$newdate = strtotime ( '-5 day' , strtotime ( $date ) ) ; // facciamo l'operazione
$newdate = date ( 'Y-m-d' , $newdate ); //trasformiamo la data nel formato accettato dal db YYYY-MM-DD
*/
	});

	$(document).ready(function(){
	
	costruisciMenu();

	impostaFiltro();
	sCerca="&filtro=";
	aggiornaParametriExport(sCerca, applicaFiltro());
	chiudiFiltro();
	aggiornaLista();

	/*
	$("#resultmyForm").html("elaborazione in corso ...");
	richiestaDati2K("myForm");
	*/
	});

	
	/* var nomiCampi=["unique_id", "posizione","datehour","product","articolo","op","qta","totalpieces"]; */
	elencoCampiLista= {
					"posizione":{"caption":"Macchina","tipo":"T","sort":""},
					"datehour" : {"caption":"Inizio produzione","tipo":"T","sort":""}, 
					 "product" : {"caption":"Prodotto","tipo":"T","sort":""}, 
					 "articolo" : {"caption":"Articolo","tipo":"T","sort":""}, 
					 "op" : {"caption":"OP","tipo":"T","sort":""}, 
					 "qta" :{"caption": "Qta prodotta","tipo":"N","sort":""}, 
					 "totalpieces" : {"caption":"somma qtaxh","tipo":"N","sort":""} 
				};

		
		
		
	function caricamento(){
			//------chiudimenu();
		};
	
	</script>
		
	
<script type='text/javascript'>

function timeFromSecs2(seconds)
{
    return(
    Math.floor(seconds/86400)+'d :'+
    Math.floor(((seconds/86400)%1)*24)+'h : '+
    Math.floor(((seconds/3600)%1)*60)+'m : '+
    Math.round(((seconds/60)%1)*60)+'s');
}

function timeFromSecs(seconds)
{
    return(
    //Math.floor(seconds/86400)+'d :'+
    Math.floor((seconds/3600))+'h : '+
    Math.floor(((seconds/3600)%1)*60)+'m : '+
    Math.round(((seconds/60)%1)*60)+'s');
}

function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}



$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myFormEdit").submit( function() {
  return false;
});

function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
$("#npag").val(0);
	$("#op").val("list");
	$("#resultmyForm").html("elaborazione in corso ...");

	richiestaDati2K("myForm",null,elencoCampiLista,impostaNpag);
};

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});

function impostaFiltro() {
	var nomeForm="myFormFiltro";
	var daysToAdd=-7;
	
    var oggi=new Date(Date.now());
    var soggi=oggi.toISOString();
    var soggiParti=soggi.split("T");
   
	var ieri= new Date();
    ieri.setDate(oggi.getDate()+daysToAdd);    
    var sieri=ieri.toISOString();
    var sieriParti=sieri.split("T");
 

	$("#a_data").val(soggiParti[0]);

	nomeCampo="start_date";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val(sieriParti[0]);
	nomeCampo += "_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val(">=");
	
	nomeCampo="end_date";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val(soggiParti[0]);
	nomeCampo +="_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("<=");

	nomeCampo="posizione";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val('');
	nomeCampo += "_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("=");
	
	nomeCampo="part_number";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val('');
	nomeCampo += "_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("=");
	
	
}

function invocaEdit(id){

	return false;
};
	
function invocaExportMovMag(){
	
	ta=$("#tipoAggregazione").val();
	filtro=$("#valFiltro").val();
	$("#tipoRappresentazione3").val("I");
	$("#tipoAggregazione3").val(ta);
	$("#valFiltro3").val(filtro);
	$("#opEdit").val("exportMovMag");
	//$("#echo").val($("#opEdit").val());
	
	//cambiaForm("Edit");
	richiestaDati("myFormHidden");
	
	
};

function invocaNuovo(){
	
	
}

function cambiaForm(){
            $("#corpoEdit").toggle();
            $("#corpoLista").toggle();

}

function scaricaReport(){
	$("#op").val("report");
	richiestaDati("myForm");
};

function aggiornaParametriSelect(nomeSelect){
	valore=$("#"+nomeSelect).val();
	aggiornaParametriExport(nomeSelect+"=", valore);
};

function aggiornaParametriExport(sCerca, valore){
	// aggiorna href per download report : 	"produzione.php?op=report&pag=1&nrighe=1000&filtro=''"
	sHref=$("a#cmdReport").prop("href");
	//sCerca="&filtro=";
	if (sHref != null) {
		n=sHref.indexOf(sCerca);
		m=sHref.indexOf("&",n+sCerca.length);
		sHref1=sHref.substring(0,n+sCerca.length);
		if (m<0) sHref2="";
		else
			sHref2=sHref.substring(m,sHref.length);
		//alert(sHref1+":"+sHref2);
		sHref=sHref1+valore+sHref2;
		$("a#cmdReport").prop("href",sHref);
	}
};



function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};




//$(document).ready(function(){
//	richiestaDati("myForm");
//});
	
function richiestaDati2K(myFormName,myAction,fcallback){
	if (fcallback && typeof fcallback === 'function') {
		var elencoCampiLista = null;
		var callback=fcallback;
	}
	else {
		 var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];
		 var callback = (typeof arguments[3] == 'undefined')?null:arguments[3];
	}	 

	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			 $pagine=info["pagine"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 $("#npag").val($pagine);
			 //var myAction="invocaEdit";
			 var myFormList=myFormName.replace("Hidden", "");
			 var myTableId=$( "#"+myFormList ).find( "table" ).attr("id");
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord2K(myArr,myTableId,myAction,elencoCampiLista);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			break;
		 default: 
			 $("#result").html($dati);
			clearInput(myFormName);
		 }
		 $("#result"+myFormName).html($esito);

		 if (callback && typeof callback === 'function') 
			callback();
	
	
		 });

};	


function scorriRecord2K(arr,id_table,myAction){
	var elencoCampiLista= (typeof arguments[3] == 'undefined')?null:arguments[3];
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
		aggiungiRiga2K(obj,id_table,myAction,elencoCampiLista);
		
	}
}

function aggiungiRiga2K(objRec,id_table,myAction){
	var elencoCampiLista= (typeof arguments[3] == 'undefined')?null:arguments[3];
	if (elencoCampiLista != null)
		obj=elencoCampiLista;
	else
		obj=objRec;

		//var table = document.getElementById(id_table);
     var tbody = $("#"+id_table).children("tbody");//table.getElementsByTagName('tbody')[0];
     //var colonne = table.getElementsByTagName('th').length;	
     var tr = document.createElement('tr');
	//var primo=true;
	var idValue="";
	var idValue1="";
	var idValue2="";
	for (var key in obj){
		var attrName = key;

		var attrValue = formatValue(objRec[key],key,elencoCampiLista);
		var attrType = myFieldType(key,elencoCampiLista);


				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				var att = document.createAttribute("class");       
				if (attrType == "N") {
					att.value = "campo_numerico";                
				}
				else {
					att.value = "campo_testo";                
				}
				td.setAttributeNode(att); 

				if (attrType != null) 
					tr.appendChild(td);
			
		
	}


	tbody.append(tr);

};

		
function aggiungiRiga2K_old(obj,id_table,myAction){
     //var table = document.getElementById(id_table);
     var tbody = $("#"+id_table).children("tbody");//table.getElementsByTagName('tbody')[0];
     //var colonne = table.getElementsByTagName('th').length;	
     var tr = document.createElement('tr');
		//var primo=true;
		var idValue="";
	 	for (var key in obj){
			var attrName = key;
			var attrValue = obj[key];
			if (attrName=="unique_id"||attrName=="p.unique_id") {idValue1=attrValue;
				atttrValue="'"+attrValue+"'";
			}
			if (attrName=="datehour" || attrName=="date") {idValue2=attrValue;	
				atttrValue="'"+attrValue+"'";
			}
			if (attrName !="unique_id" && attrName !="descrizione") {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);
				tr.appendChild(td);
			}

			
		  	
		}
		var att = document.createAttribute("onclick");       
		att.value = "invocaEdit('"+idValue1+";"+idValue2+"')";                
		tr.setAttributeNode(att); 
			

	var att = document.createAttribute("data-xref");       // Create a "data-xref" attribute
	att.value = myAction +"("+idValue+")";                // Set the value of the attribute
	tr.setAttributeNode(att); 
    
	tbody.append(tr);

};

var btn = document.getElementById("tipoAggregazione");

if (btn.addEventListener)
    btn.addEventListener("change", aggiornaLista, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", aggiornaLista);

		
</script>
</body>
</html>