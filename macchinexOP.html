<html>
<head>
<title>Associazione Macchine a OP</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<link rel="stylesheet" href="css/style-3.css" type="text/css">
<link rel="stylesheet" href="css/style-container-3.css" type="text/css">
<!--
<link href="http://fonts.googleapis.com/css?family=Bitter&subset=latin" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/nestedsidemenu.css" />
-->
</head>
<body>
	<div class="grid-container">
			<div class="colonna0" >
				<img class="menu-icon" src="img/back_01.png" onclick="var x = document.getElementById('colonna1');if (x.style.display === 'none') {   x.style.display = 'block'; $('.menu-icon').attr('src','img/back_01.png');} else {x.style.display = 'none'; $('.menu-icon').attr('src','img/forward_01.png');}"/>
			<!--</div>-->
			<div class="colonna1" id="colonna1">
<div class="header">
	<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<!--<div class="funzioni">-->
	<div id="sidebar">
			<div class="menu nestedsidemenu">
				<!--<div class="closeButton"></div>				
				<div class="nestedsidemenu">
					<br style="clear: left" />
				</div>-->
			</div>
	</div>
		<!--<div class="menuButton"></div>-->
	</div>	
	</div>
	<div class="colonna2" id="main">
        <div id="content">
			<div class="corpoLista" id="corpoLista" style="display:block">
				<div class="corpoListaHeader">Ultimi Ordini di Produzione per Macchina</div>
				<form id="myForm" action="macchinexOP.php" method="POST"> 
						<div class="nav">
								<input onclick="pagination('first')" id="exit" type="button" value="<<" />
								<input onclick="pagination('prev')" id="exit" type="button" value="<" />
								<span id="pagsup" type="text" name="pagsup" readonly="readonly" ></span>
								<input onclick="pagination('next')" id="exit" type="button" value=">" />
								<input onclick="pagination('last')" id="exit" type="button" value=">>" />
							</div>
							<div class="comandi">
									<!--
									<div class=allinea>
									<button onclick="invocaNuovo()">Nuovo</button>
									</div>
									-->
									<div class=allinea>
										<button onclick="invocaNuovoOP()">Associa Macchina a OP</button>
										</div>
										<div class=allinea>
									<button onclick="aggiornaLista()">Aggiorna</button>
									</div>
									<div class=allinea>
									<button onclick="invocaFiltro()">Ricerca</button>
									</div>
									<div class=allinea>
									<a id="cmdReport" href="macchinexOP.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
									</div>
								</div>
										<div class="lista">
						<table  id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
							<thead>
								<tr>
								<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
								<th class="sorting" id="th_id_order" onclick="setOrdinamento('id_order')">Lotto di Produzione</th>
								<th class="sorting" id="th_posizione" onclick="setOrdinamento('posizione')">Macchina</th>
								<th class="sorting" id="th_product" onclick="setOrdinamento('product')">Prodotto</th>
								<th class="sorting" id="th_requested_pieces" onclick="setOrdinamento('requested_pieces')">Qta richiesta</th>
								<th class="sorting" id="th_CNCprogram" onclick="setOrdinamento('CNCprogram')">Programma</th>
								<th class="sorting" id="th_planned_start_date" onclick="setOrdinamento('planned_start_date')">Inizio previsto</th>
								<th class="sorting" id="th_planned_end_date" onclick="setOrdinamento('planned_end_date')">Fine prevista</th>
								</tr>
							</thead>
							<tbody>
							<!-- IL BODY E' INIZIALMENTE VUOTO -->
							</tbody>
						</table>
					</div>
					<br/>
					<div class="nav">
						<input onclick="pagination('first')" id="exit" type="button" value="<<" />
						<input onclick="pagination('prev')" id="exit" type="button" value="<" />
						<span id="paginf" type="text" name="paginf" readonly="readonly" ></span>
								<input id="pag" type="hidden" name="pag" readonly="readonly" value="1" />
								<input onclick="pagination('next')" id="exit" type="button" value=">" />
						<input onclick="pagination('last')" id="exit" type="button" value=">>" />
						<input id="op" type="hidden" name="op" value="list" />
						<input id="nrighe" type="hidden" name="nrighe" value="10" />
						<input id="npag" type="hidden" name="npag" value="0" />
						<input id="ordinamento" type="hidden" name="ordinamento" value="" />
					</div>
					<div class="comandi">
						<!--
						<div class=allinea>
						<button onclick="invocaNuovo()">Nuovo</button>
						</div>
						-->
						<div class=allinea>
							<button onclick="invocaNuovoOP()">Associa Macchina a OP</button>
							</div>
							<div class=allinea>
						<button onclick="aggiornaLista()">Aggiorna</button>
						</div>
						<div class=allinea>
						<button onclick="invocaFiltro()">Ricerca</button>
						</div>
						<div class=allinea>
						<a id="cmdReport" href="macchinexOP.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
						</div>
					</div>
					<div class="filtro">
						<label id="opFiltroLabel">Filtro:</label>
						<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
					</div>
				</form>  
				<div class="esito">
					<span id="resultmyForm"></span>
				</div>
			</div>
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">Criteri di ricerca Macchine per Lotto di Produzione</div>
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td>
						<td><select class="operatore" type="text" name="id_order_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="id_order" /></input></td>
					</tr>
					<tr>
					<td>Posizione macchina</td>
						<td><select class="operatore" type="text" name="posizione_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="posizione" /></input></td>
					</tr>
					<tr>
					<td>Prodotto</td>
						<td><select class="operatore" type="text" name="product_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="product" /></td>
					</tr>
					<!--
					<tr>
					<td>Quantità richiesta</td>
						<td><select class="operatore" type="text" name="requested_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td>
						<td><select class="operatore" type="text" name="CNCprogram_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="CNCprogram" /></td>
					</tr>
					-->
					<tr>
					<td>Data prevista inizio produzione</td>
						<td><select class="operatore" type="text" name="planned_start_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td>
						<td><select class="operatore" type="text" name="planned_end_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_end_date" /></td>
					</tr>
					<tr>
							<td>Stato[0:pronta,1:iniziata,2:finita]</td>
								<td><select class="operatore" type="text" name="status_oper">
								<option value="=">=</option>
								<option value=">">></option>
								<option value="<"><</option>
								<option value=">=">>=</option>
								<option value="<="><=</option>
								<option value="<>"><></option>
								<option value="like">like</option>
								</select></td>
							<td><input type="text" name="status" /></td>
					</tr>
							<!--
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
					-->
				</table>
			</div>
			<div class="comandi">
					<button onclick="aggiornaLista(aggiornaPrmFiltroExport(applicaFiltro()))">Applica</button>
					<button onclick="chiudiFiltro()">Esci</button>
					<button onClick="this.form.reset();" >Ripristina</button>
				</div>
		</form>  

	</div>
<!--  insert      -->
	<div class="corpoInsert" id="corpoInsert" style="display:none">
		<div class="corpoInsertHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormInsert" action="macchinexOP.php" method="POST"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><select id="listboxCommessa" type="text" name="id_order" /></select></td>
					</tr>
					<tr>
					<td>Codice macchina</td><td><select id="listboxMacchina" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantità richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
				<input id="submyFormInsert" type="submit" value="Invia" />
				<button onclick="cambiaFormAggiorna('Insert')">Esci</button>
			</div>
			<div class="modo">
				<label id="opInsertLabel">Modo:</label>
				<input id="opInsert"  type="text" name="op" readonly="readonly" value="insert" />
			</div>
		</form>  

		<div class="esito">
		<span id="resultmyFormInsert"></span>
		</div>
	</div>
<!-- -->
<!--  insert  OP    -->
<div class="corpoInsert" id="corpoInsertOP" style="display:none">
	<div class="corpoInsertHeader">Associa Macchina a Ordine di Produzione</div>
	<form id="myFormInsertOP" action="macchinexOP.php" method="POST"> 
		<div class="record">
			<table>
				<tr>
					<td>Codice macchina</td><td><select id="listboxMacchinaOP" type="text" name="unique_id" onchange="caricaListaOpxMacchina2()" /></select></td>
				</tr>
				<tr>
					<td>Codice OP</td><td><select id="listboxOP" type="text" name="idop" onchange="caricaOPeListaOC()" /></select></td>
				</tr>
				<tr>
					<td>Codice Ordine Cliente</td><td><select id="listboxOC" type="text" name="idordine_cliente" onchange="valorizzaFormOP()" /></select>
						<input type="hidden" id="idordine_cliente_h" name="idordine_cliente_h" />
					</td>
				</tr>
				<tr>
					<td>Prodotto</td><td><input type="text" name="idarticolo" /></td>
				</tr>
				<tr>
					<td>Quantità richiesta</td><td><input type="number" name="qta_richiesta" /></td>
				</tr>
				<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
				</tr>
				<tr>
					<td>Data prevista inizio produzione</td><td><input onchange="condizionaData('data_ISO')" type="datetime-local" name="data_ISO" /></td>
				</tr>
				<tr>
					<td>Data prevista fine produzione</td><td><input onchange="condizionaData('data_consegna_prevista_ISO')" type="datetime-local" name="data_consegna_prevista_ISO" /></td>
				</tr>
				<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
				</tr>
			</table>
			<input onchange="condizionaDataISO('data')" type="hidden" name="data" />
			<input onchange="condizionaDataISO('data_consegna_prevista')" type="hidden" name="data_consegna_prevista" />
		</div>
		<div class="comandi">
			<input id="submyFormInsertOP" type="submit" value="Invia" />
			<button onclick="ricalcolaDataInizio()">Ricalcola Data Inizio</button>
			<button onclick="ricalcolaDataFine()">Ricalcola Data Fine</button>
			<button onclick="pulisciFormInsertOP()">Pulisci Form</button>
			<button onclick="cambiaFormAggiorna('InsertOP')">Esci</button>
			<!--<button onclick="alert($('input[name=data]').val())">Mostra</button>-->
		</div>
		<div class="modo">
			<label id="opInsertOPLabel">Modo:</label>
			<input id="opInsertOP"  type="text" name="op" readonly="readonly" value="insertOP" />
		</div>
	</form>  

	<div class="esito">
		<span id="resultmyFormInsertOP"></span>
	</div>
<!-- elenco tab-->
<div class="tab">
		<button class="tablinks" onclick="openTab(event, 'corpoLista1')">Macchine per OP</button>
		<button class="tablinks" onclick="openTab(event, 'corpoLista2')">OP per Macchina</button>
	</div>
	
	<div class="corpoLista tabcontent" id="corpoLista1">
		<div class="corpoListaHeader">
			Macchine assegnate a Ordine di Produzione
		</div>
		<form id="myFormMxCxOP" action="macchinexcommessa.php" method="POST">
			<div  class="lista">
				<table  id='my_table5' class='tabella' cellspacing='0' cellpadding='0'>
						<thead>
								<tr>
								<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
								<th>Codice Lotto</th><th>Macchina</th><th>Articolo</th><th>Qta</th><th>Data inizio</th><th>Data fine</th>
								</tr>
							</thead>
							<tbody>
								<!-- IL BODY E' INIZIALMENTE VUOTO -->
							</tbody>
				</table>
			</div>
			<br/>
			<div class="nav">
			</div>
			<div class="comandi">
				<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
				<div class=allinea>
				<!--<button onclick="lanciaProduzione()">Lancia in Produzione</button>-->
				</div>
			</div>
		</form>
		<div class="esito">
			<span id="resultmyFormMxCxOP"></span>
		</div>
	</div>
	<div class="corpoLista tabcontent" id="corpoLista2">
			<div class="corpoListaHeader">
				Ordini di Produzione assegnati a Macchine
			</div>
			<form id="myFormMxCxM" action="macchinexcommessa.php" method="POST">
				<div  class="lista">
					<table  id='my_table6' class='tabella' cellspacing='0' cellpadding='0'>
							<thead>
									<tr>
									<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
									<th>Codice Lotto</th><th>Macchina</th><th>Articolo</th><th>Qta</th><th>Data inizio</th><th>Data fine</th>
									</tr>
								</thead>
								<tbody>
									<!-- IL BODY E' INIZIALMENTE VUOTO -->
								</tbody>
					</table>
				</div>
				<br/>
				<div class="nav">
				</div>
				<div class="comandi">
					<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
					<div class=allinea>
					<!--<button onclick="lanciaProduzione()">Lancia in Produzione</button>-->
					</div>
				</div>
			</form>
			<div class="esito">
				<span id="resultmyFormMxCxOP"></span>
			</div>
		</div>
		</div>
<!-- -->
<div class="corpoEdit" id="corpoEdit" style="display:none">
		<div class="corpoEditHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormEdit" action="macchinexOP.php" method="POST" enctype="multipart/form-data"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><input type="text" name="id_order" /></td>
					</tr>
					<tr>
					<!--<td>Codice macchina</td><td><input type="text" name="unique_id" /></td>-->
					<td>Codice macchina</td><td><select id="listboxMacchinaE" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantità richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<!--
					<tr>
					<td>Data inizio produzione</td><td><input type="text" name="order_start_date" /></td>
					</tr>

					<tr>
					<td>Contapezzi inizio</td><td><input type="number" name="order_start_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					
					<!--
					<td>Contapezzi fine</td><td><input type="number" name="order_end_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
						<input id="submyFormEdit" type="submit" value="Invia" />
						<button onclick="cambiaFormAggiorna('Edit')">Esci</button>
						<button onclick="deleteRecord()">Elimina</button>
			</div>
			<div class="modo">
				<label id="opEditLabel">Modo:</label>
				<input id="opEdit"  type="text" name="op" readonly="readonly" value="edit" />
			</div>
		</form>  

		<div class="esito">
			<span id="resultmyFormEdit"></span>
		</div>
		<div class="corpoNascosto" style="display:none">
			<form id="myFormHiddenMaccxComm" action="macchinexOP.php" method="POST">
				<input id="id_order" type="text" name="id_order" value="" />
				<input id="unique_id" type="text" name="unique_id" value="" />
				<input id="filtro" type="text" name="filtro" value="" />
				<input id="op3" type="hidden" name="op" value="get" />
			</form>
			<div class="esito">
					<span id="resultmyFormHiddenMaccxComm"></span>
			</div>
			<form id="myFormHiddenOP" action="ordiniproduzione.php" method="POST">
				<input id="idop" type="text" name="idop" value="" />
				<input id="idordine_cliente" type="text" name="idordine_cliente" value="" />
				<input id="idarticolo" type="text" name="idarticolo" value="" />
				<input id="iddata_inizio_prevista" type="text" name="data" value="" />
				<input id="iddata_consegna_prevista" type="text" name="data_consegna_prevista" value="" />
				<input id="idqta_richiesta" type="text" name="qta_richiesta" value="" />
				<input id="op2" type="hidden" name="op" value="get" />
            </form>
			<form id="myFormHiddenOrdiniClienti" action="ordiniclienti.php" method="POST">
				<input id="idPK1" type="text" name="idop" value="" />
				<input id="idPK2" type="text" name="idordine_cliente" value="" />
				<input id="filtroOCget" type="hidden" name="filtro" readonly="readonly" value="" />
				<input type="hidden" name="nrighe" value="100" />
				<input type="hidden" name="npag" value="1" />
				<input type="hidden" name="pag" value="1" />
				<input id="op1" type="hidden" name="op" value="get" />
			</form>
			<form id="myFormHiddenCommesse" action="commesse.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenMacchine" action="macchine.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenListboxOP" action="ordiniproduzione.php" method="POST"> 
				<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenListboxOC" action="ordiniclienti.php" method="POST"> 
				<input id="filtroOC" type="hidden" name="filtro" />
				<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenPartPrograms" action="partprograms.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
		</div>
	</div>

	

		</div>
	</div>
</div>
<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script src="script/myScript.js" type="text/javascript"></script>
<script type="text/javascript" src="script/numberFormat154.js"></script>
<script type="text/javascript">
	
	$(document).ready(function() {
		$('.menuButton').click(function()
		{
			$('#sidebar').animate({"left":"0px"}, 10);
		});
	
		$('.closeButton').click(function()
		{
			$('#sidebar').animate({"left":"-236px"}, 10);
		});
	
		costruisciMenu();

});
	
elencoCampiListaMxC= {
		 "id_order" : {"caption":"Codice Lotto","tipo":"T","sort":""}, 
		 "posizione":{"caption":"Posizione","tipo":"T","sort":""},
		 "product" : {"caption":"Prodotto","tipo":"T","sort":""}, 
		 "requested_pieces" : {"caption":"Quantità richiesta","tipo":"N","sort":""}, 
		 "planned_start_date" : {"caption":"Inizio previsto","tipo":"D","sort":""},
		 "planned_end_date" : {"caption":"Fine prevista","tipo":"D","sort":""}, 
				};

	elencoCampiLista= {
		 "id_order" : {"caption":"Codice Lotto","tipo":"T","sort":""}, 
		 "posizione":{"caption":"Posizione","tipo":"T","sort":""},
		 "product" : {"caption":"Prodotto","tipo":"T","sort":""}, 
		 "requested_pieces" : {"caption":"Quantità richiesta","tipo":"N","sort":""}, 
		 "CNCprogram" : {"caption":"Programma","tipo":"T","sort":""}, 
		 "planned_start_date" : {"caption":"Inizio previsto","tipo":"D","sort":""},
		 "planned_end_date" : {"caption":"Fine prevista","tipo":"D","sort":""}, 
				};

		
	function caricamento(){
			//------chiudimenu();
		};

</script>
		
	
<script type='text/javascript'>


$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	$("#opEdit").val("edit");
	richiestaDati("myFormEdit");
});
 
$("#submyFormInsert").click( function() {
	richiestaDati("myFormInsert");
});
 
$("#submyFormInsertOP").click( function() {

	richiestaDati("myFormInsertOP",caricaElencoMacchinexCommessaxOP2);
});
 
$("#myFormEdit").submit( function() {
  return false;
});

$("#myFormInsert").submit( function() {
  return false;
});

$("#myFormInsertOP").submit( function() {
  return false;
});

$("#myFormCNC").submit( function() {
  return false;
});

$("#myFormTOFS").submit( function() {
  return false;
});

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});

function invocaEdit(id){
	$(':text, :file', '#myFormEdit').val('');
	$("#opEdit").val("edit");
	$("input[name='cnc_requested_pieces']").val('');
	$("input[name='cnc_machined_pieces']").val('');
	$("input[name='cnc_part_program']").val('');
	//$("#corpoCNC").hide();

	i=id.indexOf(";");
	if (i>=0) {
		id1=id.substr(0,i);
		id2=id.substr(i+1,id.length-i-1);
		$("#id_order").val(id1);
		$("#unique_id").val(id2);
		$("#op3").val("get");
		//$("#echo").val($("#opEdit").val());
		cambiaForm("Edit");
		richiestaDati("myFormHiddenMaccxComm",operazioniAusiliarieEdit);
	}
};

function invocaNuovo(){
	$("#id_order").val("");
	$("#unique_id").val("");
	$("#myFormInsert").trigger("reset");
	
	cambiaForm("Insert");
};

function invocaNuovoOP(){
	pulisciFormInsertOP();	
	cambiaForm("InsertOP");
};


function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}

function pulisciFormInsertOP(){
	$("#idop").val("");
	$("#unique_id").val("");
	//$("#opEdit").val("insert");
	//$("#echo").val($("#opEdit").val());
	$("#listboxOP").val('');
	$("#listboxOC").val('');
	$("#listboxMacchinaOP").val('');
	$("#myFormInsertOP :input[name='idarticolo']").val('');
	$("#myFormInsertOP :input[name='qta_richiesta']").val('');
	$("#myFormInsertOP :input[name='data_consegna_prevista']").val('');
	$("#myFormInsertOP :input[name='data']").val('');
	$("#myFormInsertOP :input[name='data_consegna_prevista_ISO']").val('');
	$("#myFormInsertOP :input[name='data_ISO']").val('');
	$("#my_table5 tbody tr:nth-child(n+1)").remove();
	$("#my_table6 tbody tr:nth-child(n+1)").remove();

}

function operazioniAusiliarieEdit()
{
	//caricaElencoPartProgramsxPartNumber();
	v=$("#unique_id").val();
	$("#listboxMacchinaE").val(v);
}


function cambiaForm(tipo){
            $("#corpo"+tipo).toggle();
            $("#corpoLista").toggle();

};

function cambiaFormAggiorna(tipo){
	cambiaForm(tipo);
	aggiornaLista();


};




function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
$("#npag").val(0);
	$("#op").val("list");
	$("#resultmyForm").html("elaborazione in corso ...");
	richiestaDati2K("myForm","invocaEdit",elencoCampiLista,impostaNpag);
};
function scaricaReport(){
	$("#op").val("report");
	$("#resultmyForm").html("elaborazione in corso ...");
	richiestaDati2K("myForm");
};


function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};



$(document).ready(function(){
	aggiornaLista();
});

$(document).ready(function(){
	richiestaDatiListBoxCommesse();
	richiestaDatiListBoxMacchine();
	richiestaDatiListBoxOP();
	

});

function ricalcolaDataInizio()
{
	idop=$("#listboxOP").val();
	idarticolo=$("#myFormInsertOP :input[name='idarticolo']").val();
	qta_richiesta=$("#myFormInsertOP :input[name='qta_richiesta']").val();
	data_consegna_prevista=$("#myFormInsertOP :input[name='data_consegna_prevista']").val();
	$("#idop").val(idop);
	$("#idarticolo").val(idarticolo);
	$("#idqta_richiesta").val(qta_richiesta);
	$("#iddata_consegna_prevista").val(data_consegna_prevista);
	$("#op2").val("getDataInizioProduzione");
	richiestaDati("myFormHiddenOP",condizionaDateISO);


}

function ricalcolaDataFine()
{
	idop=$("#listboxOP").val();
	idarticolo=$("#myFormInsertOP :input[name='idarticolo']").val();
	qta_richiesta=$("#myFormInsertOP :input[name='qta_richiesta']").val();
	data_inizio_prevista=$("#myFormInsertOP :input[name='data']").val();
	$("#idop").val(idop);
	$("#idarticolo").val(idarticolo);
	$("#idqta_richiesta").val(qta_richiesta);
	$("#iddata_inizio_prevista").val(data_inizio_prevista);
	$("#op2").val("getDataFineProduzione");
	richiestaDati("myFormHiddenOP",condizionaDateISO);


}

function condizionaDateISO(){
	condizionaDataISO("data_consegna_prevista");
	condizionaDataISO("data");
	
}

function valorizzaFormOP(){
	idop=$("#listboxOP").val();
	idordine_cliente=$("#listboxOC").val();
	filtro="idop='"+idop.toString()+"'";
	filtro=filtro+ " and ";
	filtro=filtro+ "idordine_cliente <= "+idordine_cliente.toString();
	$("#idPK1").val(idop);
	$("#idPK2").val(idordine_cliente);
	$("#filtroOCget").val(filtro);
	$("#op1").val("getExt");
	richiestaDati("myFormHiddenOrdiniClienti",impostaDataInizioProduzione);

}

function impostaDataInizioProduzione() {
    var oggi=new Date(Date.now());
    
	var soggi=oggi.toISOString();
	var partiData=soggi.split("T");
	soggi2=partiData[0]+"T00:00";

	$("#myFormInsertOP :input[name='data_ISO']").val(soggi2);
	condizionaData('data_ISO');
	
	ricalcolaDataFine();
}

function caricaOPeListaOC(){
	caricaListaOC(caricaOP);
	//caricaOP();
	//caricaListaOC();
}

function caricaOPfine()
{

	idordine_cliente=$("#idordine_cliente_h").val();
	$("#listboxOC").val(idordine_cliente);
	$("input[name='status']").val(0);

	// carica lista record mxc sulla form my_table5
	idop=$("#listboxOP").val();
	caricaElencoMacchinexCommessaxOP(idop,impostaDataInizioProduzione);

}
function caricaOP(){
	idop=$("#listboxOP").val();
	$("#idop").val(idop);
	$("#op2").val("getExt");
	richiestaDati("myFormHiddenOP",caricaOPfine);
}

/*
function caricaIstruzioniOP(idop,idordine_cliente,data_consegna,qta){
	
	$("#idop").val(idop);
	$("#idordine_cliente").val(idordine_cliente);
	$("#iddata_consegna_prevista").val(data_consegna);
	$("#idqta_richiesta").val(qta);
	$("#op2").val("getIstruzioni");
	richiestaDati("myFormHiddenOP");
}

function getCNCpgmIstruzioni(){
	idop=$("#idop3").val();
	idordine_cliente=$("#idoc3").val();
	data_consegna=$("#myFormCNC input[name='planned_end_date']").val();
	qta=$("#myFormCNC input[name='requested_pieces']").val();
	caricaIstruzioniOP(idop,idordine_cliente,data_consegna,qta);
}

function setCNCpgmIstruzioni(){
	$("#opCNC").val("setCNCistruzioni");
	richiestaDati("myFormCNC");

}
*/
function caricaListaOC(callback){
	idop=$("#listboxOP").val();
	filtro="idop='"+idop.toString()+"'";
	$("#filtroOC").val(filtro);
	 $.post( $("#myFormHiddenListboxOC").attr("action"),
         $("#myFormHiddenListboxOC :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxOC");
			 
			 if (callback && typeof callback === 'function') 
				callback();
		 });

};	

function richiestaDatiListBoxOC(){
	filtro="idop=587";
	$("#filtroOC").val(filtro);
	 $.post( $("#myFormHiddenListboxOC").attr("action"),
         $("#myFormHiddenListboxOC :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxOC");
			
		 });

};	


function richiestaDatiListBoxOP(){
	 $.post( $("#myFormHiddenListboxOP").attr("action"),
         $("#myFormHiddenListboxOP :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxOP");
			
		 });

};	

function richiestaDatiListBoxCommesse(){
	 $.post( $("#myFormHiddenCommesse").attr("action"),
         $("#myFormHiddenCommesse :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxCommessa");
			
		 });

};	
function richiestaDatiListBoxMacchine(){
	 $.post( $("#myFormHiddenMacchine").attr("action"),
         $("#myFormHiddenMacchine :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxMacchina");
			 scorriRecordListBox(myArr,"listboxMacchinaOP");
			 scorriRecordListBox(myArr,"listboxMacchinaE");
			 scorriRecordListBox(myArr,"listboxMacchinaC");
			 scorriRecordListBox(myArr,"listboxMacchinaT");
			
		 });

};	
function scorriRecordListBox(arr,id_select){
	var options="";
	// inserisci primo record vuoto
		var attrName = "id";
		var attrValue = -1;
		options=options+'<option value="'+attrValue+'">';
		attrName = "descr";
		attrValue = "seleziona un valore";
		options=options+attrValue+'</option>';
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
				var attrName = "id";
				var attrValue = obj["id"];
				options=options+'<option value="'+attrValue+'">';
				attrName = "descr";
				attrValue = obj["descr"];
				options=options+attrValue+'</option>';
	}
	$("#"+id_select).html(options);
}

function richiestaDati2K(myFormName,myAction){
/*	if (callback && typeof callback === 'function') 
		var elencoCampiLista = null;
	else
		 var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];
*/
var callback = (typeof arguments[3] == 'undefined')?null:arguments[3];
var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];

	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			 $pagine=info["pagine"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 $("#npag").val($pagine);
			 //var myAction="invocaEdit";
			 var myFormList=myFormName.replace("Hidden", "");
			 var myTableId=$( "#"+myFormList ).find( "table" ).attr("id");
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord2K(myArr,myTableId,myAction,elencoCampiLista);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			break;
		 default: 
			 $("#result").html($dati);
			clearInput(myFormName);
		 }
		 $("#result"+myFormName).html($esito);

		 if (callback && typeof callback === 'function') 
			callback();
	
	
		 });

};	



var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";

function caricaCommessa()
{
	
	myFormName="myFormHiddenCommesse";
    id_order_selected=$("#listboxCommessa").val();

	 $.get( $("#"+myFormName).attr("action"),
        "op=get&id_order="+id_order_selected,
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 if (risposta.substr(0,1)=="{") {
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			switch($op) {
			case "get":
				var myArr = $.parseJSON($dati);
				for (var i = 0; i < myArr.length; i++){
					var obj = myArr[i];
					for (var key in obj){
						var attrName = key;
						var attrValue = obj[key];
						//$selector="#".idForm." #".attrName;
						//$('input[type!="radio"]')
						$("input[name='"+mappa[attrName]+"']").val(attrValue);
						
					}
				}
				break;
			}
			$("#result"+myFormName).html($esito);
			}
			else {
				$("#result"+myFormName).html(risposta);
				}
			
		 });
	


}	

function caricaElencoMacchinexC(risposta,tabella) {
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 if (risposta.substr(0,1)=="{") {
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			switch($op) {
			case "getListxOP":
				var myAction=null;//$op;
				var myArr = $.parseJSON($dati);

				//scorriRecord2K(myArr,"my_table5",myAction);
				scorriRecord2K(myArr,tabella,myAction,elencoCampiListaMxC);
				break;
			case "getListxM":
				var myAction=null;//$op;
				var myArr = $.parseJSON($dati);

				//scorriRecord2K(myArr,"my_table5",myAction);
				scorriRecord2K(myArr,tabella,myAction,elencoCampiListaMxC);
				break;

				for (var i = 0; i < myArr.length; i++){
					var obj = myArr[i];
					for (var key in obj){
						var attrName = key;
						var attrValue = obj[key];
						//$selector="#".idForm." #".attrName;
						//$('input[type!="radio"]')
						$("input[name='"+mappa[attrName]+"']").val(attrValue);
						
					}
				}
				break;
			}
			$("#result"+myFormName).html($esito);
			}
			else {
				$("#result"+myFormName).html(risposta);
				}

}

function caricaElencoMacchinexCommessaxOP2()
{
	idop=$("#listboxOP").val();
	caricaElencoMacchinexCommessaxOP(idop,caricaListaOpxMacchina2);
}	

function caricaElencoMacchinexCommessaxOP(idop)
{
	var callback = (typeof arguments[1] == 'undefined')?null:arguments[1];

	idop=$("#listboxOP").val();
	$("#my_table5 tbody tr:nth-child(n+1)").remove();

	myFormName="myFormHiddenMaccxComm";
    filtro="id_order like 'OP-"+idop+"%'";
	$("#id_order").val(idop);
	$("#filtro").val(filtro);
	$("#op3").val("getListxOP");
	//richiestaDatiExt("myFormHiddenMaccxComm","myFormHiddenMaccxComm","my_table5","list","",elencoCampiListaMxC,null)
	
	 $.get( $("#"+myFormName).attr("action"),
        "op=getListxOP&filtro="+filtro,
         function(risposta){
			 caricaElencoMacchinexC(risposta,"my_table5")

			 if (callback && typeof callback === 'function') 
					callback();

		 });
	
}	

function caricaListaOpxMacchina2() {
	idmacc=$("#listboxMacchinaOP").val();
	caricaListaOpxMacchina(idmacc);
}	

function caricaListaOpxMacchina(idmacc) {
	idop=$("#listboxOP").val();
	idmacc=$("#listboxMacchinaOP").val();
	$("#my_table6 tbody tr:nth-child(n+1)").remove();

	myFormName="myFormHiddenMaccxComm";
    filtro="unique_id = '"+idmacc+"'";
	$("#id_order").val(idop);
	$("#filtro").val(filtro);
	$("#op3").val("getListxM");
	//richiestaDatiExt("myFormHiddenMaccxComm","myFormHiddenMaccxComm","my_table6","list","",elencoCampiListaMxC,null)

	$.get( $("#"+myFormName).attr("action"),
        "op=getListxM&filtro="+filtro,
         function(risposta){
			 caricaElencoMacchinexC(risposta,"my_table6")
			
		 });
		 
}	


/*
var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";
*/

</script>
</body>
</html>