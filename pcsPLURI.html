<html>
<head>
<title>Avanzamento Lotti di Produzione</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<link rel="stylesheet" href="css/style-3.css" type="text/css">
<link rel="stylesheet" href="css/style-container-3.css" type="text/css">
<!--
<link href="http://fonts.googleapis.com/css?family=Bitter&subset=latin" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/nestedsidemenu.css" />
-->
<style>
progress
{
  text-align:center;
}

progress:before {
  content:  attr(value) ' %';
}

	/*
	progress::after { 
		content: attr(value);
	*/ 

</style>
</head>
<body>
	<div class="grid-container">
			<div class="colonna0" >
				<img class="menu-icon" src="img/back_01.png" onclick="var x = document.getElementById('colonna1');if (x.style.display === 'none') {   x.style.display = 'block'; $('.menu-icon').attr('src','img/back_01.png');} else {x.style.display = 'none'; $('.menu-icon').attr('src','img/forward_01.png');}"/>
			<!--</div>-->
			<div class="colonna1" id="colonna1">
<div class="header">
	<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<!--<div class="funzioni">-->
	<div id="sidebar">
			<div class="menu nestedsidemenu">
				<!--<div class="closeButton"></div>				
				<div class="nestedsidemenu">
					<br style="clear: left" />
				</div>-->
			</div>
	</div>
				<!--<div class="menuButton"></div>-->
				</div>	
				</div>
			<div class="colonna2" id="main">
        <div id="content">
	<div class="corpoLista" id="corpoLista" style="display:block">
		<div class="corpoListaHeader">Avanzamento Produzione Macchine Plurimandrino</div>
		<form id="myForm" action="pcsPLURI.php" method="POST"> 
				<div class="nav">
						<input onclick="pagination('first')" id="exit" type="button" value="<<" />
						<input onclick="pagination('prev')" id="exit" type="button" value="<" />
						<span id="pagsup" type="text" name="pagsup" readonly="readonly" ></span>
						<input onclick="pagination('next')" id="exit" type="button" value=">" />
						<input onclick="pagination('last')" id="exit" type="button" value=">>" />
					</div>
					<div class="comandi">
							<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
							<div class=allinea>
							<button onclick="invocaNuovo()">Nuovo</button>
							</div>
							<div class=allinea>
							<button onclick="aggiornaLista()">Aggiorna</button>
							</div>
							<div class=allinea>
							<button onclick="invocaAvanzamentoPLURI()">Avanzamento PLURI</button>
							</div>
							<div class=allinea>
							<button onclick="invocaFiltro()">Ricerca</button>
							</div>
							<div class=allinea>
							<a id="cmdReport" href="pcsPLURI.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
							</div>
						</div>
						<div class="lista">
				<table  id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
				<thead>
				<tr>
				<!--<th>ID macchina</th><th>Descrizione</th>-->
				<th class="sorting" id="th_posizione" onclick="setOrdinamento('posizione')">Macchina</th>
				<!--<th class="sorting" id="th_order_start_program" onclick="setOrdinamento('order_start_program')">Programma</th>-->
				<th class="sorting" id="th_part_number" onclick="setOrdinamento('part_number')">P/N</th>
				<th class="sorting" id="th_order_start_date" onclick="setOrdinamento('order_start_date')">Data Inizio Lotto</th>
				<th class="sorting" id="th_order_start_pieces" onclick="setOrdinamento('order_start_pieces')">Qta Inizio Lotto</th>
				<th class="sorting" id="th_order_end_date" onclick="setOrdinamento('order_end_date')">Data Attuale/Fine</th>
				<th class="sorting" id="th_total_pieces" onclick="setOrdinamento('total_pieces')">Qta Total</th>
				<th class="sorting" id="th_good_pieces" onclick="setOrdinamento('good_pieces')">Qta Good</th>
				<th class="sorting" id="th_status" onclick="setOrdinamento('status')">Stato</th>
				</tr>
				</thead>
					<tbody>
					<!-- IL BODY E' INIZIALMENTE VUOTO -->
					</tbody>
				</table>
			</div>
			<br/>
			<div class="nav">
				<input onclick="pagination('first')" id="exit" type="button" value="<<" />
				<input onclick="pagination('prev')" id="exit" type="button" value="<" />
				<span id="paginf" type="text" name="paginf" readonly="readonly" ></span>
						<input id="pag" type="hidden" name="pag" readonly="readonly" value="1" />
						<input onclick="pagination('next')" id="exit" type="button" value=">" />
				<input onclick="pagination('last')" id="exit" type="button" value=">>" />
				<input id="op" type="hidden" name="op" value="list" />
				<input id="nrighe" type="hidden" name="nrighe" value="10" />
				<input id="npag" type="hidden" name="npag" value="0" />
				<input id="ordinamento" type="hidden" name="ordinamento" value="" />
			</div>
			<div class="comandi">
				<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
				<div class=allinea>
				<button onclick="invocaNuovo()">Nuovo</button>
				</div>
				<div class=allinea>
				<button onclick="aggiornaLista()">Aggiorna</button>
				</div>
				<div class=allinea>
				<button onclick="invocaAvanzamentoPLURI()">Avanzamento PLURI</button>
				</div>
				<div class=allinea>
                <button onclick="invocaFiltro()">Ricerca</button>
				</div>
				<div class=allinea>
				<a id="cmdReport" href="pcsPLURI.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
				</div>
			</div>
			<div class="filtro">
				<label id="opFiltroLabel">Filtro:</label>
				<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
            </div>
		</form>  
		<div class="esito">
		<span id="resultmyForm"></span>
		</div>
	</div> 
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">Criteri di selezione Lotto di produzione</div> 
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
					<td>Posizione Macchina</td>
						<td><select class="operatore" type="text" name="posizione_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="posizione" /></td>
					</tr>
					<!--
					<tr>
					<td>Descrizione</td><td><input type="text" name="descrizione" /></td>
					</tr>
					<tr>
					<td>Posizione</td><td><input type="text" name="posizione" /></td>
					</tr>
					-->
					<tr>
					<td>Data inizio Lotto</td>
						<td><select class="operatore" type="text" name="order_start_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="order_start_date" /></td>
					</tr>
					<tr>
					<td>Programma CNC Lotto</td>
						<td><select class="operatore" type="text" name="order_start_program_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="order_start_program" /></td>
					</tr>
					<tr>
					<td>P/N</td>
						<td><select class="operatore" type="text" name="order_part_number">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="part_number" /></td>
					</tr>
					<tr>
					<td>Qta inizio Lotto </td>
						<td><select class="operatore" type="text" name="order_start_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="numeric" name="order_start_pieces" /></td>
					</tr>
					<tr>
					<td>Data Attuale/Fine Lotto</td>
						<td><select class="operatore" type="text" name="order_end_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="order_end_date" /></td>
					</tr>
					<tr>
					<td>Qta Total</td>
						<td><select class="operatore" type="text" name="total_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="numeric" name="total_pieces" /></td>
					</tr>
					<tr>
					<td>Qta Good</td>
						<td><select class="operatore" type="text" name="good_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="numeric" name="good_pieces" /></td>
					</tr>
					<td>Stato [0:corrente, 1:archiviato]</td>
						<td><select class="operatore" type="text" name="status_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="status" /></td>
					</tr>

				</table>
			</div>
			<div class="comandi">
					<button onclick="aggiornaLista(aggiornaPrmFiltroExport(applicaFiltro()))">Applica</button>
					<button onclick="chiudiFiltro()">Esci</button>
				<button onClick="this.form.reset();impostaFiltro();" >Ripristina</button>
			</div>
		</form>  
	</div> 

<!-- -->
	<div class="corpoEdit" id="corpoEdit" style="display:none">
		<div class="corpoEditHeader">Lotto di Produzione Macchina Plurimandrino</div> 
		<form id="myFormEdit" action="pcsPLURI.php" method="POST"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Macchina</td><td><input type="text" name="unique_id" /></td>
					</tr>
					<!--
					<tr>
					<td>Descrizione</td><td><input type="text" name="descrizione" /></td>
					</tr>
					<tr>
					<td>Posizione</td><td><input type="text" name="posizione" /></td>
					</tr>
					-->
					<tr>
					<td>Data inizio Lotto</td><td><input type="text" name="order_start_date" /></td>
					</tr>
					<tr>
					<td>Programma CNC Lotto</td><td><input type="text" name="order_start_program" /></td>
					</tr>
					<tr>
					<td>P/N</td><td><input type="text" name="part_number" /></td>
					</tr>
					<tr>
					<td>Qta inizio Lotto </td><td><input type="numeric" name="order_start_pieces" /></td>
					</tr>
					<tr>
					<td>Data Attuale/Fine Lotto</td><td><input type="text" name="order_end_date" /></td>
					</tr>
					<tr>
					<td>Qta Total</td><td><input type="numeric" name="total_pieces" /></td>
					</tr>
					<tr>
					<td>Qta Good</td><td><input type="numeric" name="good_pieces" /></td>
					</tr>
					<td>Stato [0:corrente, 1:archiviato]</td><td><input type="text" name="status" /></td>
					</tr>

				</table>
			</div>
			<div class="comandi">
				<input id="submyFormEdit" type="submit" value="Invia" />
				<button onclick="deleteRecord()">Elimina</button>
				<button onclick="cambiaForm('Edit')">Esci</button>
			</div>
			<div class="modo">
				<label id="opEditLabel">Modo:</label>
				<input id="opEdit"  type="text" name="op" readonly="readonly" value="insert" />
			</div>
		</form>  
		<div class="esito" >
			<span id="resultmyFormEdit"></span>
		</div>
		<div class="corpoNascosto"style="display:none">
			<form id="myFormHiddenPCS" action="pcsPLURI.php" method="POST">
				<input id="unique_id" type="text" name="unique_id" value="" />
				<input id="order_start_date" type="text" name="order_start_date" value="" />
				<input id="op" type="hidden" name="op" value="get" />
			</form>  
		</div>
	</div> 
<!-- -->
<div class="corpoInsert" id="corpoInsertPLURI" style="display:none">
	<div class="corpoInsertHeader">Avanzamento Macchine Plurimandrino</div> 
	<form id="myFormInsertPLURI" action="pcsPLURI.php" method="POST"> 
		<div class="record">
				<p>Aggiorna l'avanzamento della produzione per le macchine Plurimandrino in base al foglio Avanzamento Produzione</p>
				<table>
				<tr>
					<td>Esercizio</td><td><input id="esercizio" type="text" name="esercizio" /></td>
				</tr>
				<tr>
					<td>Data inizio</td><td><input id="da_data"  type="date" name="da_data" /></td>
				</tr>
				<tr>
					<td>Data Attuale/Fine</td><td><input id="a_data"  type="date" name="a_data" /></td>
				</tr>
				
			</table>
		</div>
		<div class="comandi">
				<button onclick="cambiaForm('InsertPLURI');aggiornaLista()">Esci</button>
				<input id="submyFormInsertPLURI" type="submit" value="Esegui Aggiornamento" />
				<!--<button onclick="alert($('#da_data').val())">Mostra</button>-->
				<input id="percAvanzamento"  name="percAvanzamento" type="hidden" readonly="readonly" />
				<progress  id="percAvanzamento_pb"  name="percAvanzamento_pb" value="0" max="100"><span style="font-size:large;" >0%</span></progress>
		</div>
		<div class="modo">
			<label id="opInsertPLURILabel">Modo:</label>
			<input id="opInsertPLURI"  type="text" name="op" readonly="readonly" value="avanzamentoNC" />
		</div>
        <div class="filtro">
            <label id="opFiltroLabel">Filtro:</label>
            <input id="valFiltroInsert" type="text" name="filtro" readonly="readonly" value="" />
        </div>
</form>  
	<div class="esito" >
		<span id="resultmyFormInsertPLURI"></span>
	</div>
	<div class="corpoNascosto"style="display:none">
		<form id="myFormHiddenPLURI" action="pcsPLURI.php" method="POST">
			<input id="unique_id" type="text" name="unique_id" value="" />
			<input id="order_start_date" type="text" name="order_start_date" value="" />
			<input id="op" type="hidden" name="op" value="get" />
		</form>  
	</div>
</div> 

</div> 
	</div> 
</div> 

<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script src="script/myScript.js" type="text/javascript"></script>
<script src="script/NumberFormat154.js" type="text/javascript"></script>
<script type="text/javascript">
	
	$(document).ready(function() {
		$('.menuButton').click(function()
		{
			$('#sidebar').animate({"left":"0px"}, 10);
		});
	
		$('.closeButton').click(function()
		{
			$('#sidebar').animate({"left":"-236px"}, 10);
		});
	});

		elencoPKs= {
					"1":"unique_id",
					"2":"order_start_date" 
				};


	elencoCampiLista= {
					"posizione":{"caption":"Macchina","tipo":"T","sort":""},
					"part_number" : {"caption":"Articolo","tipo":"T","sort":""}, 
				//	"order_start_program" : {"caption":"Programma","tipo":"T","sort":""}, 
					"order_start_date" : {"caption":"Data inizio","tipo":"D","sort":""}, 
					"order_start_pieces" :{"caption": "Qta inizio lotto","tipo":"N","sort":""}, 
					"order_end_date" : {"caption":"Data fine","tipo":"D","sort":""}, 
					 "total_pieces" :{"caption": "Qta richiesta","tipo":"N","sort":""}, 
					 "good_pieces" : {"caption":"Qta prodotta","tipo":"N","sort":""}, 
					 "status" : {"caption":"Stato","tipo":"N","sort":""} 
				};
	elencoCampiListaOP=elencoCampiLista;
		
	function caricamento(){
			//------chiudimenu();
		};
	
	</script>
		
	
<script type='text/javascript'>

function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}


$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myFormEdit").submit( function() {
  return false;
});

var lastPercAv=0;
var tickLastPercAv=0;
var maxTick=15;

$("#submyFormInsertPLURI").click( function() {
	$("#opInsertPLURI").val("avanzamentoNC");
	$("#percAvanzamento").val(0);
	lastPercAv=0;
	tickLastPercAv=0;
	aggiornaPBar("percAvanzamento");
	richiestaDati("myFormInsertPLURI",checkAvanzamento);
});
 
$("#myFormInsertPLURI").submit( function() {
  return false;
});

function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
$("#npag").val(0);
	$("#op").val("list");
	richiestaDati2K("myForm",'invocaEdit',elencoCampiListaOP,elencoPKs,impostaNpag);
};

$(document).ready(function(){

	costruisciMenu();

	impostaFiltro();
	applicaFiltro();
	chiudiFiltro();
	aggiornaLista();
});

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});

function impostaFiltro() {
	var nomeForm="myFormFiltro";

	/*
	nomeCampo="posizione";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("37");
	var nomeCampo="posizione_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("<");
	*/
	nomeCampo="status";
	sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("0");
	nomeCampo="status_oper";
	//$("div.id_100 select").val("val2");
	sel="#"+nomeForm+" select[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val("=");
	
}

function invocaEdit(id){

	i=id.indexOf(";");
	if (i>=0) {
	id1=id.substr(0,i);
	id2=id.substr(i+1,id.length-i-1);
	$("#unique_id").val(id1);
	$("#order_start_date").val(id2);
	$("#opEdit").val("edit");
	//$("#echo").val($("#opEdit").val());
	$()
	cambiaForm("Edit");
	richiestaDati("myFormHiddenPCS");
	}
	
};

function invocaNuovo(){
	$("#unique_id").val("");
	$("order_start_date").val("");
	$("#opEdit").val("insert");
	$("#myFormInsert").trigger("reset");

	cambiaForm('Insert');
	richiestaDati("myFormHiddenPCS");
	
}

function invocaAvanzamentoPLURI(){
    // esercizio, data odierna, data odierna
    var oggi=new Date(Date.now());
    
    var soggi=oggi.toISOString();
    var soggiParti=soggi.split("T");
    var esercizioParti=soggiParti[0].split("-");


	$("#esercizio").val(esercizioParti[0]);
	$("#a_data").val(soggiParti[0]);
	$("#da_data").val(soggiParti[0]);

	//$("#opEdit").val("insert");
	//$("#echo").val($("#opEdit").val());
	
	cambiaForm("InsertPLURI");
};

function aggiornaPBar(percId) {
	
	percAvanzamento=$("#"+percId).val();
	percpbId=percId+"_pb";
	$("#"+percpbId).val(percAvanzamento);

	
	var pBar = document.getElementById(percpbId);
	pBar.value = percAvanzamento;
  	pBar.getElementsByTagName('span')[0].innerHTML = percAvanzamento+"%";
	
}

function checkAvanzamento() {
	percAvanzamento=$("#percAvanzamento").val();
	aggiornaPBar("percAvanzamento");
	if (percAvanzamento == lastPercAv) {
		tickLastPercAv++;
	}
	else {
		lastPercAv=percAvanzamento;
		tickLastPercAv=0;
	}

	if (percAvanzamento < 100) {
		if (tickLastPercAv <=maxTick) {
			timeoutID=window.setTimeout(callCheckAvanzamento,2000);
			//richiestaDati("myFormInsertPLURI",checkAvanzamento);
		}
		else {
			$("#resultmyFormInsertPLURI").html("timeout - operazione non completata");
		}
	}
}


function callCheckAvanzamento() {
	$("#opInsertPLURI").val("getCheckAvanzamentoNC");
	richiestaDati("myFormInsertPLURI",checkAvanzamento);
}

function cambiaForm(tipo){
            $("#corpo"+tipo).toggle();
            $("#corpoLista").toggle();

};

/*
function cambiaForm(){
            $("#corpoEdit").toggle();
            $("#corpoLista").toggle();

}
*/

function scaricaReport(){
	$("#op").val("report");
	richiestaDati2K("myForm");
};


function avanzamentoMacchineNC(){
	$("#resultmyForm").html("elaborazione in corso ...");
	$("#npag").val(0);
	$("#op").val("avanzamentoNC");
	richiestaDati2K("myForm");
	

};




function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};




//$(document).ready(function(){
//	richiestaDati("myForm");
//});
	
function richiestaDati2K(myFormName,myAction){
	var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];
		 var elencoPKs = (typeof arguments[3] == 'undefined')?null:arguments[3];
		 var callback = (typeof arguments[4] == 'undefined')?null:arguments[4];

	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			 $pagine=info["pagine"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 $("#npag").val($pagine);
			 //var myAction="invocaEdit";
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord2K(myArr,"my_table",myAction,elencoCampiLista,elencoPKs);
			 $("#resultmyForm").html($esito);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			 $("#resultmyForm").html($esito);
			break;
		 default: 
			 $("#resultmyForm").html($dati);
			clearInput(myFormName);
		 }

		 if (callback && typeof callback === 'function') 
			callback();
	
		
			
		 });

};	


		
</script>
</body>
</html>