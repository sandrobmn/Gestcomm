<html>
<head>
<title>Part Programs</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<link rel="stylesheet" href="css/style-3.css" type="text/css">
<link rel="stylesheet" href="css/style-container-3.css" type="text/css">
<!--
<link href="http://fonts.googleapis.com/css?family=Bitter&subset=latin" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/nestedsidemenu.css" />
-->
</head>
<body onload="caricamento()">
	<div class="grid-container">
			<div class="colonna0" >
				<img class="menu-icon" src="img/back_01.png" onclick="var x = document.getElementById('colonna1');if (x.style.display === 'none') {   x.style.display = 'block'; $('.menu-icon').attr('src','img/back_01.png');} else {x.style.display = 'none'; $('.menu-icon').attr('src','img/forward_01.png');}"/>
			<!--</div>-->
			<div class="colonna1" id="colonna1">
<div class="header">
		<!--<div class="menu-trigger" style="float:left">
				<button type="button" onclick="aprichiudimenu()">Menu</button>
			</div>-->
		<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<!--<div class="funzioni">-->
	<div id="sidebar">
			<div class="menu nestedsidemenu">
				<!--<div class="closeButton"></div>				
				<div class="nestedsidemenu">
					<br style="clear: left" />
				</div>-->
			</div>
	</div>
		<!--<div class="menuButton"></div>	-->
		</div>
		</div>
    <div class="colonna2" id="main"  >
        <div id="content">
	<div class="corpoLista" id="corpoLista" >
		<div class="corpoListaHeader">
			Elenco Part Programs
		</div>
		<form id="myForm" action="partprograms.php" method="POST"> 
				<div class="nav">
						<input onclick="pagination('first')" id="exit" type="button" value="<<" />
						<input onclick="pagination('prev')" id="exit" type="button" value="<" />
						<span id="pagsup" type="text" name="pagsup" readonly="readonly" ></span>
						<input onclick="pagination('next')" id="exit" type="button" value=">" />
						<input onclick="pagination('last')" id="exit" type="button" value=">>" />
					</div>
					<div class="comandi">
							<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
							<div class=allinea>
							<button onclick="invocaNuovo()">Nuovo</button>
							</div>
							<div class=allinea>
							<button onclick="aggiornaLista()">Aggiorna</button>
							</div>
							<div class=allinea>
							<button onclick="invocaFiltro()">Ricerca</button>
							</div>
							<!--<div class=allinea>
							<button onclick="invocaAggiornamentoCommesse()">Aggiornamento Commesse</button>
							</div>-->
							<div class=allinea>
							<a id="cmdReport" href="partprograms.php?op=report&pag=1&npag=1&nrighe=1000&filtro="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
							</div>
						</div>
						<div class="lista">
				<table  id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
				<thead>
				<tr>
				<th class="sorting" id="th_part_number" onclick="setOrdinamento('part_number')">Part Number</th>
				<th class="sorting" id="th_id_tipom" onclick="setOrdinamento('id_tipom')">Tipo Macchina</th>
				<th class="sorting" id="th_path_n" onclick="setOrdinamento('path_n')">Path</th>
				<th class="sorting" id="th_part_program" onclick="setOrdinamento('part_program')">Part Program</th>
				</tr>
				</thead>
					<tbody>
					<!-- IL BODY E' INIZIALMENTE VUOTO -->
					</tbody>
				</table>
			</div>
			<br/>
			<div class="nav">
				<input onclick="pagination('first')" id="exit" type="button" value="<<" />
				<input onclick="pagination('prev')" id="exit" type="button" value="<" />
				<span id="paginf" type="text" name="paginf" readonly="readonly" ></span>
				<input id="pag" type="hidden" name="pag" readonly="readonly" value="1" />
				<input onclick="pagination('next')" id="exit" type="button" value=">" />
				<input onclick="pagination('last')" id="exit" type="button" value=">>" />
				<input id="op" type="hidden" name="op" value="list" />
				<input id="nrighe" type="hidden" name="nrighe" value="10" />
				<input id="npag" type="hidden" name="npag" value="0" />
				<input id="ordinamento" type="hidden" name="ordinamento" value="" />
			</div>
			<div class="comandi">
				<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
				<div class=allinea>
				<button onclick="invocaNuovo()">Nuovo</button>
				</div>
				<div class=allinea>
				<button onclick="aggiornaLista()">Aggiorna</button>
				</div>
				<div class=allinea>
                <button onclick="invocaFiltro()">Ricerca</button>
				</div>
				<!--<div class=allinea>
                <button onclick="invocaAggiornamentoCommesse()">Aggiornamento Commesse</button>
				</div>-->
				<div class=allinea>
				<a id="cmdReport" href="partprograms.php?op=report&pag=1&npag=1&nrighe=1000&filtro="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
				</div>
			</div>
			<div class="filtro">
				<label id="opFiltroLabel">Filtro:</label>
				<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
            </div>
			<!--<div class="comando2">
				<input id="op2" type="hidden" name="op2" readonly="readonly" value="" />
            </div>-->
		</form>  
		<div class="esito" >
			<span id="resultmyForm"></span>
		</div>
	</div>
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">
		Criteri di ricerca Part Programs  
		</div>
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
                        <td>Part Number</td>
						<td><select class="operatore" type="text" name="part_number_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
						<td><input type="text" name="part_number" /></td>
					</tr>
					<tr>
					<td>Tipo Macchina</td>
						<td><select class="operatore" type="text" name="id_tipom_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="id_tipom" /></td>
					</tr>
					<td>Path</td>
						<td><select class="operatore" type="text" name="path_n_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="path_n" /></td>
					</tr>
					<td>Part Program</td>
						<td><select class="operatore" type="text" name="part_program_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="part_program" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
				
					<button onclick="aggiornaLista(aggiornaPrmFiltroExport(applicaFiltro()))">Applica</button>
					<button onclick="chiudiFiltro()">Esci</button>
					<button onClick="this.form.reset();" >Ripristina</button>
				</div>

		</form>  

	</div>    
<!--        -->
<div class="corpoInsert" id="corpoInsert" style="display:none">
	<div class="corpoInsertHeader">Part Program</div>
	<form id="myFormInsert" action="partprograms.php" method="POST"> 
		<div class="record">
			<table>
				<tr>
				<td>Part Number</td><td><select id="listboxPartNumbers" type="text" name="part_number" /></td>
				</tr>
				<tr>
				<td>Tipo Macchina</td><td><select id="listboxTipiMacchina" type="text" name="id_tipom" /></td>
				</tr>
				<tr>
				<td>Path</td><td><input type="text" name="path_n" /></td>
				</tr>
				<tr>
				<td>Part Program</td><td><input type="text" name="part_program" /></td>
				</tr>
			</table>
	</div>
		<div class="comandi">
			<input id="submyFormInsert" type="submit" value="Invia" />
			<button onclick="cambiaForm('Insert')">Esci</button>
		</div>
		<div class="modo">
			<label id="opInsertLabel">Modo:</label>
			<input id="opInsert"  type="text" name="op" readonly="readonly" value="insert" />
		</div>
	</form>  

	<div class="esito">
	<span id="resultmyFormInsert"></span>
	</div>
		<div class="corpoNascosto" style="display:none">
<!--
		<form id="myFormHiddenTipi" action="partprograms.php" method="POST">
			<input id="part_number" type="text" name="part_number" value="" />
			<input id="id_tipom" type="text" name="id_tipom" value="" />
			<input id="path_n" type="text" name="path_n" value="" />
			<input id="op" type="hidden" name="op" value="get" />
		</form>
-->
		<form id="myFormHiddenPartNUmbers" action="partnumbers.php" method="POST"> 
			<input id="op" type="hidden" name="op" value="listbox" />
		</form>
		<form id="myFormHiddenTipiMacchina" action="TipiMacchina.php" method="POST"> 
			<input id="op" type="hidden" name="op" value="listbox" />
		</form>
	</div>
</div>


	<!-- -->    
    <div class="corpoEdit" id="corpoEdit" style="display:none">
		<div class="corpoEditHeader">
			Part Program  
		</div>
		<form id="myFormEdit" action="partprograms.php" method="POST"> 
			<div class="record">
				<table>
					<tr>
					<td>Part Number</td><td><input type="text" name="part_number" /></td>
					</tr>
					<tr>
					<td>Tipo Macchina</td><td><input type="text" name="id_tipom" /></td>
					</tr>
					<tr>
                    <td>Path</td><td><input type="text" name="path_n" /></td>
                    </tr>
                    <tr>
                    <td>Part Program</td><td><input type="text" name="part_program" /></td>
                    </tr>
                </table>
			</div>
			<div class="comandi">
				<input id="submyFormEdit" type="submit" value="Invia" />
				<button onclick="deleteRecord()">Elimina</button>
				<button onclick="cambiaForm('Edit')">Esci</button>
			</div>
			<div class="modo">
				<label id="opEditLabel">Modo:</label>
				<input id="opEdit"  type="text" name="op" readonly="readonly" value="edit" />
			</div>
		</form>  
		<div class="esito" >
			<span id="resultmyFormEdit"></span>
		</div>
		<div class="corpoNascosto"style="display:none">
			<form id="myFormHiddenPartPrograms" action="partprograms.php" method="POST">
				<input id="part_number" type="text" name="part_number" value="" />
				<input id="id_tipom" type="text" name="id_tipom" value="" />
				<input id="path_n" type="text" name="path_n" value="" />
				<input id="op" type="hidden" name="op" value="get" />
			</form>
		</div>
	</div>
	</div>
	</div>
</div>
<div style="clear:both"></div>
<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script src="script/myScript.js" type="text/javascript"></script>
<script type="text/javascript">

$(document).ready(function() {
	$('.menuButton').click(function()
	{
        $('#sidebar').animate({"left":"0px"}, 10);
    });

	$('.closeButton').click(function()
	{
        $('#sidebar').animate({"left":"-236px"}, 10);
	});
	
	costruisciMenu();

});

	/*  */
	elencoCampiLista= {
					"part_number":{"caption":"Part Number","tipo":"T","sort":""},
					"id_tipom" : {"caption":"Tipo Macchina","tipo":"T","sort":""},
					"path_n":{"caption":"Path","tipo":"T","sort":""},
					"part_program" : {"caption":"Part Program","tipo":"T","sort":""}
				};


	
function caricamento(){
		//------chiudimenu();
	};

</script>
	
<script type='text/javascript'>

function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}


$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myFormEdit").submit( function() {
  return false;
});

$("#submyFormInsert").click( function() {
	richiestaDati("myFormInsert");
});
 
$("#myFormInsert").submit( function() {
  return false;
});

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});


function invocaEdit(id){
	pks=id.split(';');
	i=pks.length;
	if (i>=2) {
		$("#part_number").val(pks[0]);
		$("#id_tipom").val(pks[1]);
		$("#path_n").val(pks[2]);
		
		//$("#opEdit").val("edit");
		
		cambiaForm('Edit');
		richiestaDati("myFormHiddenPartPrograms");
	}
};

function invocaNuovo(){
	$(':text, :password, :file', '#myFormInsert').not("#opInsert").val('');
	$(':input,select option, checkbox', '#myFormInsert').removeAttr('checked').removeAttr('selected');
	$('select option:first', '#myFormInsert').attr('selected',true);
	/*
	$("#part_number").val("");
	$("#id_tipom").val("");
	$("#path_n").val("");
	*/
	//$("#opEdit").val("insert");
	
	cambiaForm('Insert');
	//richiestaDati("myFormHiddenTipi");
	
};

function cambiaForm(tipo){
            $("#corpo"+tipo).toggle();
            $("#corpoLista").toggle();

};

/*
function invocaAggiornamentoCommesse(){
	$("#op2").val("aggiorna");
	aggiornaLista();
	$("#op2").val("");
};
*/

function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
$("#npag").val(0);
	$("#op").val("list");
	richiestaDati3K("myForm",impostaNpag);
	
};
function scaricaReport(){
	$("#op").val("report");
	richiestaDati3K("myForm");
};


function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};
/*
function cambiaForm(){
            $("#corpoEdit").toggle();
            $("#corpoLista").toggle();

};
*/
$(document).ready(function(){
	aggiornaLista();
});

$(document).ready(function(){
	richiestaDatiListBoxPartNumbers();
	richiestaDatiListBoxTipiMacchina();
});

function richiestaDatiListBoxPartNumbers(){
	 $.post( $("#myFormHiddenPartNUmbers").attr("action"),
         $("#myFormHiddenPartNUmbers :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxPartNumbers");
			
		 });

};	

function richiestaDatiListBoxTipiMacchina(){
	 $.post( $("#myFormHiddenTipiMacchina").attr("action"),
         $("#myFormHiddenTipiMacchina :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxTipiMacchina");
			
		 });

};	

function scorriRecordListBox(arr,id_select){
	var options="";
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
				var attrName = "id";
				var attrValue = obj["id"];
				options=options+'<option value="'+attrValue+'">';
				attrName = "descr";
				attrValue = obj["descr"];
				options=options+attrValue+'</option>';
	}
	$("#"+id_select).html(options);
}


function richiestaDati3K(myFormName,fcallback){
	if (fcallback && typeof fcallback === 'function') {
		var elencoCampiLista = null;
		var callback=fcallback;
	}
	else {
		 var elencoCampiLista = (typeof arguments[1] == 'undefined')?null:arguments[1];
		 var callback = (typeof arguments[2] == 'undefined')?null:arguments[2];
	}	 

	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			 $pagine=info["pagine"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 $("#npag").val($pagine);
			 var myAction="invocaEdit";
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord3K(myArr,"my_table",myAction);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			break;
		 default: 
			 $("#result").html($dati);
			clearInput(myFormName);
		 }

		 if (callback && typeof callback === 'function') 
			callback();
	
			
		 });

};	


function scorriRecord3K(arr,id_table,myAction){
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
		aggiungiRiga3K(obj,id_table);
		
	}
}

function aggiungiRiga3K(obj,id_table,myAction){
     //var table = document.getElementById(id_table);
     var tbody = $("#"+id_table).children("tbody");//table.getElementsByTagName('tbody')[0];
     //var colonne = table.getElementsByTagName('th').length;	
     var tr = document.createElement('tr');
		//var primo=true;
		var idValue="";
	 	for (var key in obj){
			var attrName = key;
			var attrValue = obj[key];
			if (attrName=="part_number") {idValue1=attrValue;
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("id_tipom") >=0) {idValue2=attrValue;	
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("path_n") >=0) {idValue3=attrValue;	
				atttrValue="'"+attrValue+"'";
			}
			//if (attrName.indexOf("path_n") < 0) {
			if (1) {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				tr.appendChild(td);
			}
			
		  	
		}
		var att = document.createAttribute("onclick");       
		att.value = "invocaEdit('"+idValue1+";"+idValue2+";"+idValue3+"')";                
		tr.setAttributeNode(att); 
			

	var att = document.createAttribute("data-xref");       // Create a "data-xref" attribute
	att.value = myAction +"("+idValue+")";                // Set the value of the attribute
	tr.setAttributeNode(att); 
    
	tbody.append(tr);

};


/*
jQuery( function($) {
        $('tbody tr[data-href]').addClass('clickable').click( function() {
            $("#corpoEdit").toggle();
            $("#corpoLista").toggle();
        }).find('a').hover( function() {
            $(this).parents('tr').unbind('click');
        }, function() {
            $(this).parents('tr').click( function() {
                window.location = $(this).attr('data-href');
            });
        });
});


jQuery( function($) {
        $('tbody tr[data-href]').addClass('clickable').click( function() {
            window.location = $(this).attr('data-href');
        }).find('a').hover( function() {
            $(this).parents('tr').unbind('click');
        }, function() {
            $(this).parents('tr').click( function() {
                window.location = $(this).attr('data-href');
            });
        });
});
*/
</script>
</body>
</html>