<html>
<head>
<title>Macchine per Lotto di Produzione</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<link rel="stylesheet" href="css/style-3.css" type="text/css">
<link rel="stylesheet" href="css/style-container-3.css" type="text/css">
<!--
<link href="http://fonts.googleapis.com/css?family=Bitter&subset=latin" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/nestedsidemenu.css" />
-->
</head>
<body>
	<div class="grid-container">
			<div class="colonna0" >
				<img class="menu-icon" src="img/back_01.png" onclick="var x = document.getElementById('colonna1');if (x.style.display === 'none') {   x.style.display = 'block'; $('.menu-icon').attr('src','img/back_01.png');} else {x.style.display = 'none'; $('.menu-icon').attr('src','img/forward_01.png');}"/>
			<!--</div>-->
			<div class="colonna1" id="colonna1">
<div class="header">
	<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<!--<div class="funzioni">-->
	<div id="sidebar">
			<div class="menu nestedsidemenu">
				<!--<div class="closeButton"></div>				
				<div class="nestedsidemenu">
					<br style="clear: left" />
				</div>-->
			</div>
	</div>
		<!--<div class="menuButton"></div>-->
	</div>
	</div>	
	<div class="colonna2" id="main">
        <div id="content">
			<div class="corpoLista" id="corpoLista" style="display:block">
				<div class="corpoListaHeader">Elenco Macchine per Lotto di Produzione</div>
				<form id="myForm" action="macchinexcommesse.php" method="POST"> 
						<div class="nav">
								<input onclick="pagination('first')" id="exit" type="button" value="<<" />
								<input onclick="pagination('prev')" id="exit" type="button" value="<" />
								<span id="pagsup" type="text" name="pagsup" readonly="readonly" ></span>
								<input onclick="pagination('next')" id="exit" type="button" value=">" />
								<input onclick="pagination('last')" id="exit" type="button" value=">>" />
							</div>
							<div class="comandi">
									<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
									<div class=allinea>
									<button onclick="invocaNuovo()">Nuovo</button>
									</div>
									<!--<div class=allinea>
										<button onclick="invocaNuovoOP()">Associa Macchina a OP</button>
										</div>-->
										<div class=allinea>
									<button onclick="aggiornaLista()">Aggiorna</button>
									</div>
									<div class=allinea>
									<button onclick="invocaFiltro()">Ricerca</button>
									</div>
									<div class=allinea>
									<a id="cmdReport" href="macchinexcommesse.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
									</div>
								</div>
										<div class="lista">
						<table  id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
							<thead>
								<tr>
								<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
								<th class="sorting" id="th_id_order" onclick="setOrdinamento('id_order')">Lotto di Produzione</th>
								<th class="sorting" id="th_posizione" onclick="setOrdinamento('posizione')">Macchina</th>
								<th class="sorting" id="th_product" onclick="setOrdinamento('product')">Prodotto</th>
								<th class="sorting" id="th_requested_pieces" onclick="setOrdinamento('requested_pieces')">Qta richiesta</th>
								<th class="sorting" id="th_CNCprogram" onclick="setOrdinamento('CNCprogram')">Programma</th>
								<th class="sorting" id="th_planned_start_date" onclick="setOrdinamento('planned_start_date')">Inizio previsto</th>
								<th class="sorting" id="th_planned_end_date" onclick="setOrdinamento('planned_end_date')">Fine prevista</th>
								</tr>
							</thead>
							<tbody>
							<!-- IL BODY E' INIZIALMENTE VUOTO -->
							</tbody>
						</table>
					</div>
					<br/>
					<div class="nav">
						<input onclick="pagination('first')" id="exit" type="button" value="<<" />
						<input onclick="pagination('prev')" id="exit" type="button" value="<" />
						<span id="paginf" type="text" name="paginf" readonly="readonly" ></span>
								<input id="pag" type="hidden" name="pag" readonly="readonly" value="1" />
								<input onclick="pagination('next')" id="exit" type="button" value=">" />
						<input onclick="pagination('last')" id="exit" type="button" value=">>" />
						<input id="op" type="hidden" name="op" value="list" />
						<input id="nrighe" type="hidden" name="nrighe" value="10" />
						<input id="npag" type="hidden" name="npag" value="0" />
						<input id="ordinamento" type="hidden" name="ordinamento" value="" />
					</div>
					<div class="comandi">
						<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
						<div class=allinea>
						<button onclick="invocaNuovo()">Nuovo</button>
						</div>
						<!--<div class=allinea>
							<button onclick="invocaNuovoOP()">Associa Macchina a OP</button>
							</div>-->
							<div class=allinea>
						<button onclick="aggiornaLista()">Aggiorna</button>
						</div>
						<div class=allinea>
						<button onclick="invocaFiltro()">Ricerca</button>
						</div>
						<div class=allinea>
						<a id="cmdReport" href="macchinexcommesse.php?op=report&pag=1&npag=1&nrighe=1000&filtro=&ordinamento="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
						</div>
					</div>
					<div class="filtro">
						<label id="opFiltroLabel">Filtro:</label>
						<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
					</div>
				</form>  
				<div class="esito">
					<span id="resultmyForm"></span>
				</div>
			</div>
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">Criteri di ricerca Macchine per Lotto di Produzione</div>
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td>
						<td><select class="operatore" type="text" name="id_order_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="id_order" /></input></td>
					</tr>
					<tr>
					<td>Posizione macchina</td>
						<td><select class="operatore" type="text" name="posizione_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="posizione" /></input></td>
					</tr>
					<tr>
					<td>Prodotto</td>
						<td><select class="operatore" type="text" name="product_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantit√† richiesta</td>
						<td><select class="operatore" type="text" name="requested_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td>
						<td><select class="operatore" type="text" name="CNCprogram_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td>
						<td><select class="operatore" type="text" name="planned_start_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td>
						<td><select class="operatore" type="text" name="planned_end_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_end_date" /></td>
					</tr>
					<tr>
							<td>Stato[0:pronta,1:iniziata,2:finita]</td>
								<td><select class="operatore" type="text" name="status_oper">
								<option value="=">=</option>
								<option value=">">></option>
								<option value="<"><</option>
								<option value=">=">>=</option>
								<option value="<="><=</option>
								<option value="<>"><></option>
								<option value="like">like</option>
								</select></td>
							<td><input type="text" name="status" /></td>
					</tr>
							<!--
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
					-->
				</table>
			</div>
			<div class="comandi">
					<button onclick="aggiornaLista(aggiornaPrmFiltroExport(applicaFiltro()))">Applica</button>
					<button onclick="chiudiFiltro()">Esci</button>
					<button onClick="this.form.reset();impostaFiltro();" >Ripristina</button>
				</div>
		</form>  

	</div>
<!--  insert      -->
	<div class="corpoInsert" id="corpoInsert" style="display:none">
		<div class="corpoInsertHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormInsert" action="macchinexcommesse.php" method="POST"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><select id="listboxCommessa" type="text" name="id_order" /></select></td>
					</tr>
					<tr>
					<td>Codice macchina</td><td><select id="listboxMacchina" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantit√† richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
				<input id="submyFormInsert" type="submit" value="Invia" />
				<button onclick="cambiaFormAggiorna('Insert')">Esci</button>
			</div>
			<div class="modo">
				<label id="opInsertLabel">Modo:</label>
				<input id="opInsert"  type="text" name="op" readonly="readonly" value="insert" />
			</div>
		</form>  

		<div class="esito">
		<span id="resultmyFormInsert"></span>
		</div>
	</div>
<!-- -->
<!-- -->
<div class="corpoEdit" id="corpoEdit" style="display:none">
		<div class="corpoEditHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormEdit" action="macchinexcommesse.php" method="POST" enctype="multipart/form-data"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><input type="text" name="id_order" /></td>
					</tr>
					<tr>
					<!--<td>Codice macchina</td><td><input type="text" name="unique_id" /></td>-->
					<td>Codice macchina</td><td><select id="listboxMacchinaE" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantit√† richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<!--
					<tr>
					<td>Data inizio produzione</td><td><input type="text" name="order_start_date" /></td>
					</tr>

					<tr>
					<td>Contapezzi inizio</td><td><input type="number" name="order_start_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					
					<!--
					<td>Contapezzi fine</td><td><input type="number" name="order_end_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
						<input id="submyFormEdit" type="submit" value="Invia" />
						<button onclick="cambiaFormAggiorna('Edit')">Esci</button>
						<button onclick="deleteRecord()">Elimina</button>
			</div>
			<div class="modo">
				<label id="opEditLabel">Modo:</label>
				<input id="opEdit"  type="text" name="op" readonly="readonly" value="edit" />
			</div>
		</form>  

		<div class="esito">
			<span id="resultmyFormEdit"></span>
		</div>
		<div class="corpoNascosto" style="display:none">
			<form id="myFormHiddenMaccxComm" action="macchinexcommesse.php" method="POST">
				<input id="id_order" type="text" name="id_order" value="" />
				<input id="unique_id" type="text" name="unique_id" value="" />
				<input id="filtro" type="text" name="filtro" value="" />
				<input id="op3" type="hidden" name="op" value="get" />
			</form>
			<div class="esito">
					<span id="resultmyFormHiddenMaccxComm"></span>
			</div>
			<form id="myFormHiddenOP" action="ordiniproduzione.php" method="POST">
				<input id="idop" type="text" name="idop" value="" />
				<input id="idordine_cliente" type="text" name="idordine_cliente" value="" />
				<input id="idarticolo" type="text" name="idarticolo" value="" />
				<input id="iddata_consegna_prevista" type="text" name="data_consegna_prevista" value="" />
				<input id="idqta_richiesta" type="text" name="qta_richiesta" value="" />
				<input id="op2" type="hidden" name="op" value="get" />
            </form>
			<form id="myFormHiddenOrdiniClienti" action="ordiniclienti.php" method="POST">
				<input id="idPK1" type="text" name="idop" value="" />
				<input id="idPK2" type="text" name="idordine_cliente" value="" />
				<input id="filtroOCget" type="hidden" name="filtro" readonly="readonly" value="" />
				<input type="hidden" name="nrighe" value="100" />
				<input type="hidden" name="npag" value="1" />
				<input type="hidden" name="pag" value="1" />
				<input id="op1" type="hidden" name="op" value="get" />
			</form>
			<form id="myFormHiddenCommesse" action="commesse.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenMacchine" action="macchine.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenListboxOP" action="ordiniproduzione.php" method="POST"> 
				<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenListboxOC" action="ordiniclienti.php" method="POST"> 
				<input id="filtroOC" type="hidden" name="filtro" />
				<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenPartPrograms" action="partprograms.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
		</div>
	</div>


	

		</div>
	</div>
</div>
<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script src="script/myScript.js" type="text/javascript"></script>
<script src="script/NumberFormat154.js" type="text/javascript"></script>
<script type="text/javascript">
	
	$(document).ready(function() {
		$('.menuButton').click(function()
		{
			$('#sidebar').animate({"left":"0px"}, 10);
		});
	
		$('.closeButton').click(function()
		{
			$('#sidebar').animate({"left":"-236px"}, 10);
		});
	
		costruisciMenu();

	});
	
	elencoCampiLista= {
		 "id_order" : {"caption":"Codice Lotto","tipo":"T","sort":""}, 
		 "posizione":{"caption":"Posizione","tipo":"T","sort":""},
		 "product" : {"caption":"Prodotto","tipo":"T","sort":""}, 
		 "requested_pieces" : {"caption":"Quantit√† richiesta","tipo":"N","sort":""}, 
		 "CNCprogram" : {"caption":"Programma","tipo":"T","sort":""}, 
		 "planned_start_date" : {"caption":"Inizio previsto","tipo":"D","sort":""},
		 "planned_end_date" : {"caption":"Fine prevista","tipo":"D","sort":""}, 
 


				};
		
	function caricamento(){
			//------chiudimenu();
		};

</script>
		
	
<script type='text/javascript'>


$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	$("#opEdit").val("edit");
	richiestaDati("myFormEdit");
});
 
$("#submyFormInsert").click( function() {
	richiestaDati("myFormInsert");
});
 
 
$("#myFormEdit").submit( function() {
  return false;
});

$("#myFormInsert").submit( function() {
  return false;
});

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});



function invocaEdit(id){
	$(':text, :file', '#myFormEdit').val('');
	$("#opEdit").val("edit");
	$("input[name='cnc_requested_pieces']").val('');
	$("input[name='cnc_machined_pieces']").val('');
	$("input[name='cnc_part_program']").val('');
	//$("#corpoCNC").hide();

	i=id.indexOf(";");
	if (i>=0) {
		id1=id.substr(0,i);
		id2=id.substr(i+1,id.length-i-1);
		$("#id_order").val(id1);
		$("#unique_id").val(id2);
		$("#op3").val("get");
		//$("#echo").val($("#opEdit").val());
		cambiaForm("Edit");
		richiestaDati("myFormHiddenMaccxComm",operazioniAusiliarieEdit);
	}
};

function invocaNuovo(){
	$("#id_order").val("");
	$("#unique_id").val("");
	$("#myFormInsert").trigger("reset");
	
	cambiaForm("Insert");
};


function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}

function operazioniAusiliarieEdit()
{
	v=$("#unique_id").val();
	$("#listboxMacchinaE").val(v);
}

function cambiaForm(tipo){
            $("#corpo"+tipo).toggle();
            $("#corpoLista").toggle();

};

function cambiaFormAggiorna(tipo){
	cambiaForm(tipo);
	aggiornaLista();


};





function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
$("#npag").val(0);
	$("#op").val("list");
	$("#resultmyForm").html("elaborazione in corso ...");
	richiestaDati2K("myForm","invocaEdit",elencoCampiLista,impostaNpag);
};
function scaricaReport(){
	$("#op").val("report");
	$("#resultmyForm").html("elaborazione in corso ...");
	richiestaDati2K("myForm",null);
};


function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};



$(document).ready(function(){
	aggiornaLista();
});

$(document).ready(function(){
	richiestaDatiListBoxCommesse();
	richiestaDatiListBoxMacchine();
	//richiestaDatiListBoxOP();
	

});


function richiestaDatiListBoxCommesse(){
	 $.post( $("#myFormHiddenCommesse").attr("action"),
         $("#myFormHiddenCommesse :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxCommessa");
			
		 });

};	
function richiestaDatiListBoxMacchine(){
	 $.post( $("#myFormHiddenMacchine").attr("action"),
         $("#myFormHiddenMacchine :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxMacchina");
			 scorriRecordListBox(myArr,"listboxMacchinaOP");
			 scorriRecordListBox(myArr,"listboxMacchinaE");
			 scorriRecordListBox(myArr,"listboxMacchinaC");
			 scorriRecordListBox(myArr,"listboxMacchinaT");
			
		 });

};	
function scorriRecordListBox(arr,id_select){
	var options="";
	// inserisci primo record vuoto
		var attrName = "id";
		var attrValue = -1;
		options=options+'<option value="'+attrValue+'">';
		attrName = "descr";
		attrValue = "seleziona un valore";
		options=options+attrValue+'</option>';
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
				var attrName = "id";
				var attrValue = obj["id"];
				options=options+'<option value="'+attrValue+'">';
				attrName = "descr";
				attrValue = obj["descr"];
				options=options+attrValue+'</option>';
	}
	$("#"+id_select).html(options);
}

function richiestaDati2K(myFormName,myAction){
/*	if (callback && typeof callback === 'function') 
		var elencoCampiLista = null;
	else
		 var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];
*/
var callback = (typeof arguments[3] == 'undefined')?null:arguments[3];
var elencoCampiLista = (typeof arguments[2] == 'undefined')?null:arguments[2];

	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			 $pagine=info["pagine"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 $("#npag").val($pagine);
			 var myFormList=myFormName.replace("Hidden", "");
			 var myTableId=$( "#"+myFormList ).find( "table" ).attr("id");
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord2K(myArr,"my_table",myAction,elencoCampiLista);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			break;
		 default: 
			 $("#result").html($dati);
			clearInput(myFormName);
		 }
		 $("#result"+myFormName).html($esito);

		 if (callback && typeof callback === 'function') 
			callback();
	
	
		 });

};	






/*
function aggiungiRiga2K(obj,id_table,myAction){
     //var table = document.getElementById(id_table);
     var tbody = $("#"+id_table).children("tbody");//table.getElementsByTagName('tbody')[0];
     //var colonne = table.getElementsByTagName('th').length;	
     var tr = document.createElement('tr');
	//var primo=true;
	var idValue="";
	for (var key in obj){
		var attrName = key;
		var attrValue = obj[key];

		if (myAction != 'listaPartPrograms' && myAction != 'getListxOP' ) {
			if (attrName=="id_order") {idValue1=attrValue;
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("unique_id") >=0) {idValue2=attrValue;	
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("unique_id") < 0) {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				tr.appendChild(td);
			}
	}
	else {
		if (attrName.indexOf("part_number") < 0) {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				tr.appendChild(td);
			}

	}		
		
	}

	if (myAction != 'listaPartPrograms' && myAction != 'getListxOP' ) {
		var att = document.createAttribute("onclick");       
		att.value = "invocaEdit('"+idValue1+";"+idValue2+"')";                
		tr.setAttributeNode(att); 

		var att = document.createAttribute("data-xref");       // Create a "data-xref" attribute
		att.value = myAction +"("+idValue+")";                // Set the value of the attribute
		tr.setAttributeNode(att); 
	}

	tbody.append(tr);

};
*/

var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";

function caricaCommessa()
{
	
	myFormName="myFormHiddenCommesse";
    id_order_selected=$("#listboxCommessa").val();

	 $.get( $("#"+myFormName).attr("action"),
        "op=get&id_order="+id_order_selected,
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 if (risposta.substr(0,1)=="{") {
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			switch($op) {
			case "get":
				var myArr = $.parseJSON($dati);
				for (var i = 0; i < myArr.length; i++){
					var obj = myArr[i];
					for (var key in obj){
						var attrName = key;
						var attrValue = obj[key];
						//$selector="#".idForm." #".attrName;
						//$('input[type!="radio"]')
						$("input[name='"+mappa[attrName]+"']").val(attrValue);
						
					}
				}
				break;
			}
			$("#result"+myFormName).html($esito);
			}
			else {
				$("#result"+myFormName).html(risposta);
				}
			
		 });
	


}	





/*
var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";
*/

</script>
</body>
</html>