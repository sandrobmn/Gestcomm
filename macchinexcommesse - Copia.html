<html>
<head>
<title>Macchine per Lotto di Produzione</title>
<meta charset="utf-8">
<meta name="description" content="Gestione Avanzamento Produzione"> <!--descrizione sintetica viualizzata nei motori di ricerca-->
<meta name="keywords" content="">
<meta name="robots" content="all"> <!--indica allo spider quali pagine indicizzare -->
<meta name="rating" content="general"> <!--decrive il tipo di pubblico (general, mature, restricted, 14years, safe for kids) -->
<meta http-equiv="expires" content="0"> <!--fa scaricare al browser sempre la copia aggiornata-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<link rel="stylesheet" href="css/style.css" type="text/css">
<link rel="stylesheet" href="css/style-container.css" type="text/css">
</head>
<body>
<div class="header">
	<div class="logo">
		<img src="img/exacta-logo.png" />
	</div>
	<div class="title">
	Gestione Avanzamento Produzione
	</div>
</div>
<div style="clear:both;"></div>
<div class="funzioni">
		<div id="sidebar">
				<div class="menu">
					<div class="closeButton"><!--<a class="icon-close"></a>--></div>				
					<a href="index.html">Home</a>
					<a href="commesse.html">Lotti di Produzione</a>
					<a href="macchine.html">Macchine</a>
					<a href="macchinexcommesse.html">Macchine per Lotto di Produzione</a>
					<a href="pcs.html">Avanzamento Lotti di produzione</a>
					<a href="produzione.html">Produzione</a>
					<a href="impieghi.html">Impieghi per Macchina</a>
					<a href="impieghixcommessa.html">Impieghi per Lotto di Produzione</a>
					<a href="opzioni.html">Opzioni</a>
				</div>
			</div>
			<div class="menuButton"><!--<a class="icon-menu"></a>--></div>	
			<div id="main">
        <div id="content">
	<div class="corpoLista" id="corpoLista" style="display:block">
		<div class="corpoListaHeader">Elenco Macchine per Lotto di Produzione</div>
		<form id="myForm" action="macchinexcommesse.php" method="POST"> 
			<div class="lista">
				<table border='2' id='my_table' class='tabella' cellspacing='0' cellpadding='0'>
					<thead>
						<tr>
						<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
						<th>Lotto di Produzione</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Fine prevista</th>
						</tr>
					</thead>
					<tbody>
						<!-- IL BODY E' INIZIALMENTE VUOTO -->
					</tbody>
				</table>
			</div>
			<br/>
			<div class="nav">
				<input onclick="pagination('first')" id="exit" type="button" value="<<" />
				<input onclick="pagination('prev')" id="exit" type="button" value="<" />
				<input id="pag" type="number" name="pag" readonly="readonly" value="1" />
				<input onclick="pagination('next')" id="exit" type="button" value=">" />
				<input onclick="pagination('last')" id="exit" type="button" value=">>" />
				<input id="op" type="hidden" name="op" value="list" />
				<input id="nrighe" type="hidden" name="nrighe" value="10" />
			</div>
			<div class="comandi">
				<!--<button onclick="window.location.href='commessa.html'">Nuovo</button>-->
				<div class=allinea>
				<button onclick="invocaNuovo()">Nuovo</button>
				</div>
				<div class=allinea>
				<button onclick="aggiornaLista()">Aggiorna</button>
				</div>
				<div class=allinea>
                <button onclick="invocaFiltro()">Ricerca</button>
				</div>
				<div class=allinea>
				<a id="cmdReport" href="macchinexcommesse.php?op=report&pag=1&nrighe=1000&filtro="><img src="img/excel.jpg" width="32px" height="32px" alt="Scarica Report Excel"/></a>
				</div>
			</div>
			<div class="filtro">
				<label id="opFiltroLabel">Filtro:</label>
				<input id="valFiltro" type="text" name="filtro" readonly="readonly" value="" />
            </div>
		</form>  
		<div class="esito">
		<span id="resultmyForm"></span>
		</div>
	</div>
<!-- filtro -->
	<div class="corpoFiltro" id="corpoFiltro" style="display:none">
		<div class="corpoFiltroHeader">Criteri di ricerca Macchine per Lotto di Produzione</div>
		<form id="myFormFiltro" > 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td>
						<td><select class="operatore" type="text" name="id_order_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="id_order" /></input></td>
					</tr>
					<tr>
					<td>Posizione macchina</td>
						<td><select class="operatore" type="text" name="posizione_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input  type="text" name="posizione" /></input></td>
					</tr>
					<tr>
					<td>Prodotto</td>
						<td><select class="operatore" type="text" name="product_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantità richiesta</td>
						<td><select class="operatore" type="text" name="requested_pieces_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td>
						<td><select class="operatore" type="text" name="CNCprogram_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td>
						<td><select class="operatore" type="text" name="planned_start_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td>
						<td><select class="operatore" type="text" name="planned_end_date_oper">
						<option value="=">=</option>
						<option value=">">></option>
						<option value="<"><</option>
						<option value=">=">>=</option>
						<option value="<="><=</option>
						<option value="<>"><></option>
						<option value="like">like</option>
						</select></td>
					<td><input type="text" name="planned_end_date" /></td>
					</tr>
					<!--
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
					-->
				</table>
			</div>
			<div class="comandi">
				<button onclick="applicaFiltro()">Applica</button>
				<button onclick="chiudiFiltro()">Esci</button>
				<input type="reset">
			</div>
		</form>  

	</div>
<!--        -->
	<div class="corpoInsert" id="corpoInsert" style="display:none">
		<div class="corpoInsertHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormInsert" action="macchinexcommesse.php" method="POST"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><select id="listboxCommessa" type="text" name="id_order" /></select></td>
					</tr>
					<tr>
					<td>Codice macchina</td><td><select id="listboxMacchina" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" name="product" /></td>
					</tr>
					<tr>
					<td>Quantità richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
					
				</table>
			</div>
			<div class="comandi">
				<input id="submyFormInsert" type="submit" value="Invia" />
				<button onclick="cambiaForm('Insert')">Esci</button>
			</div>
			<div class="modo">
				<label id="opInsertLabel">Modo:</label>
				<input id="opInsert"  type="text" name="op" readonly="readonly" value="insert" />
			</div>
		</form>  

		<div class="esito">
		<span id="resultmyFormInsert"></span>
		</div>
	</div>

	<div class="corpoEdit" id="corpoEdit" style="display:none">
		<div class="corpoEditHeader">Macchina per Lotto di Produzione</div>
		<form id="myFormEdit" action="macchinexcommesse.php" method="POST" enctype="multipart/form-data"> 
			<div class="record">
				<table>
					<tr>
					<td>Codice Lotto</td><td><input type="text" name="id_order" /></td>
					</tr>
					<tr>
					<!--<td>Codice macchina</td><td><input type="text" name="unique_id" /></td>-->
					<td>Codice macchina</td><td><select id="listboxMacchinaE" type="text" name="unique_id" /></select></td>
					</tr>
					<tr>
					<td>Prodotto</td><td><input type="text" id="product" name="product" onchange="caricaElencoPartProgramsxPartNumber()"/></td>
					</tr>
					<tr>
					<td>Quantità richiesta</td><td><input type="number" name="requested_pieces" /></td>
					</tr>
					<tr>
					<td>Programma</td><td><input type="text" name="CNCprogram" /></td>
					</tr>
					<tr>
					<td>Data prevista inizio produzione</td><td><input type="text" name="planned_start_date" /></td>
					</tr>
					<!--
					<tr>
					<td>Data inizio produzione</td><td><input type="text" name="order_start_date" /></td>
					</tr>

					<tr>
					<td>Contapezzi inizio</td><td><input type="number" name="order_start_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Data prevista fine produzione</td><td><input type="text" name="planned_end_date" /></td>
					</tr>
					
					<!--
					<td>Contapezzi fine</td><td><input type="number" name="order_end_pieces" /></td>
					</tr>
					-->
					<tr>
					<td>Stato[0:pronta,1:iniziata,2:finita]</td><td><input type="text" name="status" /></td>
					</tr>
				</table>
			</div>
			<div class="comandi">
						<input id="submyFormEdit" type="submit" value="Invia" />
						<button onclick="cambiaForm('Edit')">Esci</button>
						<button onclick="deleteRecord()">Elimina</button>
						<button onclick="setupCNC()">Setup CNC</button>
						<!--<button onclick="caricaElencoPartProgramsxPartNumber()">Carica elenco part-program</button>-->
				</div>
				<div style="clear:both"></div>
			<div class="corpoCNC" id="corpoCNC" style="display:none">
				<table>
					<tr>
						<td style="font-weight:bold;padding:20px;">Setup CNC<td></td>
					</tr>
					<tr>
							<td style="font-weight:bold;padding:10px;">Impostazione Contapezzi<td></td>
					</tr>
					<tr>
						<td>Pezzi richiesti CNC</td><td><input type="number" name="cnc_requested_pieces" /></td>
					</tr>
					<tr>
						<td>Pezzi già prodotti CNC</td><td><input type="number" name="cnc_machined_pieces" /></td>
					</tr>
					<tr><td><button onclick="getCNCcounter()">Leggi contapezzi CNC</button></td><td><button onclick="setCNCcounter()">Set contapezzi CNC</button></td></tr>
					<tr>
							<td style="font-weight:bold;padding:10px;">Caricamento programma su >CNC<td></td>
					</tr>
					<tr><td style="vertical-align:top">Programmi CNC per PartNumber:</td>
						<td>
						<table border='2' id='my_table2' class='tabella' cellspacing='0' cellpadding='0'>
								<thead>
										<tr>
										<!--<th>Commessa</th><th>Macchina</th><th>Prodotto</th><th>Qta richiesta</th><th>Programma</th><th>Inizio previsto</th><th>Inizio effettivo</th><th>Contapezzi inizio</th><th>Fine prevista</th><th>Fine effettiva</th><th>Contapezzi fine</th>-->
										<th>Tipo CNC</th><th>Path</th><th>Programma</th>
										</tr>
									</thead>
									<tbody>
										<!-- IL BODY E' INIZIALMENTE VUOTO -->
									</tbody>
						</table>
						</td>
					</tr>
					<tr>
					<td>Programma CNC</td><td><input type="file" name="cnc_part_program" id="cnc_part_program" /></td>
					</tr>
					<tr>
					<td>Folder CNC</td><td><input type="text" name="cnc_folder_part_program" value="//CNC_MEM/USER/PATH1"/></td>
					</tr>
					<tr><td>(es.//CNC_MEM/USER/PATH1)</td><td><button onclick="setCNCprogram()">Set programma CNC</button></td></tr>
				</table>
				<div class="comandi2">
					<!--<button onclick="getCNCcounter()">Get contapezzi CNC</button>
					
					<button onclick="setCNCprogram()">Set programma CNC</button>
					<button onclick="caricaElencoPartProgramsxPartNumber()">Carica elenco part-program</button>-->
				</div>
			</div>
<!--			<div class="comandi">
				<input id="submyFormEdit" type="submit" value="Invia" />
				<button onclick="cambiaForm('Edit')">Esci</button>
				<button onclick="deleteRecord()">Elimina</button>
			</div>-->
			<div class="modo">
				<label id="opEditLabel">Modo:</label>
				<input id="opEdit"  type="text" name="op" readonly="readonly" value="edit" />
			</div>
		</form>  

		<div class="esito">
			<span id="resultmyFormEdit"></span>
		</div>
		<div class="corpoNascosto" style="display:none">
			<form id="myFormHiddenMaccxComm" action="macchinexcommesse.php" method="POST">
				<input id="id_order" type="text" name="id_order" value="" />
				<input id="unique_id" type="text" name="unique_id" value="" />
				<input id="op" type="hidden" name="op" value="get" />
			</form>
			<div class="esito">
					<span id="resultmyFormHiddenMaccxComm"></span>
			</div>
			<form id="myFormHiddenCommesse" action="commesse.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenMacchine" action="macchine.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
			<form id="myFormHiddenPartPrograms" action="partprograms.php" method="POST"> 
					<input id="op" type="hidden" name="op" value="listbox" />
			</form>
		</div>
	</div>
	</div>
	</div>
</div>
<!--<script src="script/jquery-1.12.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="script/jquery-1.9.1.js"></script>
<script src="script/myScript.js" type="text/javascript"></script>
<script type="text/javascript">
	
	$(document).ready(function() {
		$('.menuButton').click(function()
		{
			$('#sidebar').animate({"left":"0px"}, 1000);
		});
	
		$('.closeButton').click(function()
		{
			$('#sidebar').animate({"left":"-236px"}, 1000);
		});
	});
	
		
	function caricamento(){
			//------chiudimenu();
		};

</script>
		
	
<script type='text/javascript'>

function setupCNC(){
	$("#corpoCNC").toggle();

}

function getCNCcounter(){
		$("#opEdit").val("getCNCcounter");
	//richiestaDati("myFormEdit");
	richiestaDati("myFormEdit");

		};


function setCNCcounter(){
		$("#opEdit").val("setCNCcounter");
	richiestaDati("myFormEdit");

		};

function setCNCprogram(){
	//alert("programma:"+$("#cnc_part_program").val());
		$("#opEdit").val("setCNCprogram");
	//richiestaDati("myFormEdit");
	var formElement = document.querySelector("#myFormEdit");
	var formData = new FormData(formElement);
    var file_data = $("#cnc_part_program").prop("files")[0];   
    //var form_data = new FormData();
    formData.append("file", file_data);
    //alert(formData);
    $.ajax({
        url: "macchinexcommesse.php",
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,                         
        type: 'post',
        success: function(risposta){
			$("#result"+"myFormEdit").html(risposta);
            //alert("works"); 
        }
    });

		};



function deleteRecord(){
$("#opEdit").val("delete");
	richiestaDati("myFormEdit");

}

function pagination(pagina) {
	npag=parseInt($("#pag").val());
	if (pagina=='first') $("#pag").val(1);
	if (pagina=='last') $("#pag").val(1000);
	if (pagina=='next') $("#pag").val( npag+1);
	if (pagina=='prev') $("#pag").val( npag-1);
	npag=$("#pag").val();
	if (npag<=0) $("#pag").val(1);
	npag=$("#pag").val();
	aggiornaLista();
}


$("#sub").click( function() {
	richiestaDati("myFormEdit");
});
 
$("#myForm").submit( function() {
  return false;
});


$("#submyFormEdit").click( function() {
	$("#opEdit").val("edit");
	richiestaDati("myFormEdit");
});
 
$("#submyFormInsert").click( function() {
	richiestaDati("myFormInsert");
});
 
$("#myFormEdit").submit( function() {
  return false;
});

$("#myFormInsert").submit( function() {
  return false;
});

$("#submyFormFiltro").click( function() {
	return false;
});
 
$("#myFormFiltro").submit( function() {
  return false;
});



function invocaEdit(id){
	$(':text, :file', '#myFormEdit').val('');
	$("#opEdit").val("edit");
	$("input[name='cnc_requested_pieces']").val('');
	$("input[name='cnc_machined_pieces']").val('');
	$("input[name='cnc_part_program']").val('');
	$("#corpoCNC").hide();

	i=id.indexOf(";");
	if (i>=0) {
		id1=id.substr(0,i);
		id2=id.substr(i+1,id.length-i-1);
		$("#id_order").val(id1);
		$("#unique_id").val(id2);
		$("#op").val("get");
		//$("#echo").val($("#opEdit").val());
		cambiaForm("Edit");
		richiestaDati("myFormHiddenMaccxComm",operazioniAusiliarie);
	}
};

function invocaNuovo(){
	$("#id_order").val("");
	$("#unique_id").val("");
	//$("#opEdit").val("insert");
	//$("#echo").val($("#opEdit").val());
	
	cambiaForm("Insert");
	
	
};

function cambiaForm(tipo){
            $("#corpo"+tipo).toggle();
            $("#corpoLista").toggle();

};

function aggiornaLista(){
$("#my_table tbody tr:nth-child(n+1)").remove();
	$("#op").val("list");
	richiestaDati2K("myForm");
};
function scaricaReport(){
	$("#op").val("report");
	richiestaDati2K("myForm");
};

function valutaCriterioFiltro(nomeForm, nomeCampo) {
    criterio="";
    sel="#"+nomeForm+" input[name="+'"'+nomeCampo+'"'+"]";
    valore=$(sel).val();
    if (valore !='' && valore != undefined) {
        sel="#"+nomeForm+" select[name="+'"'+nomeCampo+"_oper"+'"'+"]";
        operatore=$(sel).val();
        criterio=nomeCampo+" "+operatore+" '"+valore+"' ";
    }
    return criterio;
};
    
function valutaFiltro(nomeForm) {
    var nomiCampi = ["id_order","posizione","product","requested_pieces","CNCprogram","planned_start_date","planned_end_date"];
	criteri="";
	for (var i=0;i<nomiCampi.length;i++){
		nomeCampo=nomiCampi[i];
		criterio=valutaCriterioFiltro(nomeForm, nomeCampo)
		if (criterio !="") {
			if (criteri !="") criteri=criteri+" and "
			criteri=criteri+criterio;
		}
	}
       
    return criteri;
};
    
function applicaFiltro(){
	criteri=valutaFiltro("myFormFiltro");
    
    chiudiFiltro();
    $("#valFiltro").val(criteri);
	// aggiorna href per download report : 	"produzione.php?op=report&pag=1&nrighe=1000&filtro=''"
	$("a#cmdReport").prop("href","macchinexcommesse.php?op=report&pag=1&nrighe=1000&filtro="+criteri);
	aggiornaLista();
};

function invocaFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};

function chiudiFiltro(){
            $("#corpoFiltro").toggle();
            $("#corpoLista").toggle();

};



$(document).ready(function(){
	richiestaDati2K("myForm");
});

$(document).ready(function(){
	richiestaDatiListBoxCommesse();
	richiestaDatiListBoxMacchine();
});

function richiestaDatiListBoxCommesse(){
	 $.post( $("#myFormHiddenCommesse").attr("action"),
         $("#myFormHiddenCommesse :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxCommessa");
			
		 });

};	
function richiestaDatiListBoxMacchine(){
	 $.post( $("#myFormHiddenMacchine").attr("action"),
         $("#myFormHiddenMacchine :input").serializeArray(),
         function(risposta){
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
		 
			 var myArr = $.parseJSON($dati);
			 scorriRecordListBox(myArr,"listboxMacchina");
			 scorriRecordListBox(myArr,"listboxMacchinaE");
			
		 });

};	
function scorriRecordListBox(arr,id_select){
	var options="";
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
				var attrName = "id";
				var attrValue = obj["id"];
				options=options+'<option value="'+attrValue+'">';
				attrName = "descr";
				attrValue = obj["descr"];
				options=options+attrValue+'</option>';
	}
	$("#"+id_select).html(options);
}

function richiestaDati2K(myFormName){
	 $.post( $("#"+myFormName).attr("action"),
         $("#"+myFormName+" :input").serializeArray(),
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
		 switch($op) {
		 case "list":
			 $("#pag").val($pagina);
			 var myAction="invocaEdit";
			 
			 var myArr = $.parseJSON($dati);
			 scorriRecord2K(myArr,"my_table",myAction);
			 break;
		 case "get":
			 var myArr = $.parseJSON($dati);
			 scorriRecordGet(myArr,"myFormEdit");
			break;
		 default: 
			 $("#result").html($dati);
			clearInput(myFormName);
		 }
			
		 });

};	


function scorriRecord2K(arr,id_table,myAction){
	for (var i = 0; i < arr.length; i++){
		var obj = arr[i];
		aggiungiRiga2K(obj,id_table,myAction);
		
	}
}

function aggiungiRiga2K(obj,id_table,myAction){
     //var table = document.getElementById(id_table);
     var tbody = $("#"+id_table).children("tbody");//table.getElementsByTagName('tbody')[0];
     //var colonne = table.getElementsByTagName('th').length;	
     var tr = document.createElement('tr');
	//var primo=true;
	var idValue="";
	for (var key in obj){
		var attrName = key;
		var attrValue = obj[key];

		if (myAction != 'listaPartPrograms') {
			if (attrName=="id_order") {idValue1=attrValue;
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("unique_id") >=0) {idValue2=attrValue;	
				atttrValue="'"+attrValue+"'";
			}
			if (attrName.indexOf("unique_id") < 0) {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				tr.appendChild(td);
			}
	}
	else {
		if (attrName.indexOf("part_number") < 0) {
				var td = document.createElement('td');
				var tx = document.createTextNode(attrValue);
				td.appendChild(tx);

				tr.appendChild(td);
			}

	}		
		
	}

	if (myAction != 'listaPartPrograms') {
		var att = document.createAttribute("onclick");       
		att.value = "invocaEdit('"+idValue1+";"+idValue2+"')";                
		tr.setAttributeNode(att); 

		var att = document.createAttribute("data-xref");       // Create a "data-xref" attribute
		att.value = myAction +"("+idValue+")";                // Set the value of the attribute
		tr.setAttributeNode(att); 
	}

	tbody.append(tr);

};

var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";

function caricaCommessa()
{
	
	myFormName="myFormHiddenCommesse";
    id_order_selected=$("#listboxCommessa").val();

	 $.get( $("#"+myFormName).attr("action"),
        "op=get&id_order="+id_order_selected,
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 if (risposta.substr(0,1)=="{") {
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			switch($op) {
			case "get":
				var myArr = $.parseJSON($dati);
				for (var i = 0; i < myArr.length; i++){
					var obj = myArr[i];
					for (var key in obj){
						var attrName = key;
						var attrValue = obj[key];
						//$selector="#".idForm." #".attrName;
						//$('input[type!="radio"]')
						$("input[name='"+mappa[attrName]+"']").val(attrValue);
						
					}
				}
				break;
			}
			$("#result"+myFormName).html($esito);
			}
			else {
				$("#result"+myFormName).html(risposta);
				}
			
		 });
	


}	

/*
var btn = document.getElementById("listboxCommessa");

if (btn.addEventListener)
    btn.addEventListener("change", caricaCommessa, false);
else if (btn.attachEvent)
    btn.attachEvent("onchange", caricaCommessa);

var mappa = new Array();
mappa["id_order"]="id_order";mappa["prodotto"]="product";mappa["qta"]="requested_pieces";
mappa["data_inizio"]="planned_start_date";mappa["data_fine"]="planned_end_date";
*/
function operazioniAusiliarie()
{
	caricaElencoPartProgramsxPartNumber();
	v=$("#unique_id").val();
	$("#listboxMacchinaE").val(v);
}
function caricaElencoPartProgramsxPartNumber()
{
	$("#my_table2 tbody tr:nth-child(n+1)").remove();

	myFormName="myFormHiddenPartPrograms";
    part_number_selected=$("#product").val();

	 $.get( $("#"+myFormName).attr("action"),
        "op=get&part_number="+part_number_selected,
         function(risposta){
			// $("#result").html(risposta);
			 
			 //var oper=document.getElementById("myForm");
			 //alert(oper.value);
			 //alert($("#myForm #pag").attr("name"));
			 if (risposta.substr(0,1)=="{") {
			 var info = $.parseJSON(risposta);
			 $esito=info["esito"];
			 $op=info["richiesta"];
			 $dati=info["dati"];
			 $pagina=info["pagina"];
			switch($op) {
			case "get":
				var myAction='listaPartPrograms';
				var myArr = $.parseJSON($dati);

				scorriRecord2K(myArr,"my_table2",myAction);
				break;

				for (var i = 0; i < myArr.length; i++){
					var obj = myArr[i];
					for (var key in obj){
						var attrName = key;
						var attrValue = obj[key];
						//$selector="#".idForm." #".attrName;
						//$('input[type!="radio"]')
						$("input[name='"+mappa[attrName]+"']").val(attrValue);
						
					}
				}
				break;
			}
			$("#result"+myFormName).html($esito);
			}
			else {
				$("#result"+myFormName).html(risposta);
				}
			
		 });
	


}	



</script>
</body>
</html>